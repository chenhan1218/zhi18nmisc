<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="zh-TW" xml:lang="zh-TW" xmlns="http://www.w3.org/1999/xhtml">
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
 
 <title> Linux 的 Database-SQL-RDBMS HOWTO 文件 (PostgreSQL 物件關聯資料庫系統): 資料庫保安 </title>
 <link href="PostgreSQL-HOWTO-11.html" rel="next" />
 <link href="PostgreSQL-HOWTO-9.html" rel="previous" />
  <link href="index.html" rel="start" title="HOWTO：Database-SQL-RDBMS HOWTO for Linux" />
 <link href="index.html#content" rel="contents" />
 <link href="index.html#appendix" rel="appendix" title="附錄" />
 <link href="http://www2.tw.postgresql.org/" rel="alternate" title="來源處" />
 <link href="PostgreSQL-HOWTO-1.html" rel="chapter" title="1.引言" />
 <link href="PostgreSQL-HOWTO-2.html" rel="chapter" title="2.物理定律適用於電腦軟件！" />
 <link href="PostgreSQL-HOWTO-3.html" rel="chapter" title="3.PostgreSQL 是什麼？" />
 <link href="PostgreSQL-HOWTO-4.html" rel="chapter" title="4.哪個較好？PostgreSQL 還是 MySQL？" />
 <link href="PostgreSQL-HOWTO-5.html" rel="chapter" title="5.何處取得 ?" />
 <link href="PostgreSQL-HOWTO-6.html" rel="chapter" title="6.PostgreSQL 快速安裝指引" />
 <link href="PostgreSQL-HOWTO-7.html" rel="chapter" title="7.快速開始指引" />
 <link href="PostgreSQL-HOWTO-8.html" rel="chapter" title="8.PostgreSQL 支援超過 200 Gig 的超級資料庫" />
 <link href="PostgreSQL-HOWTO-9.html" rel="chapter" title="9.憑什麼相信 PostgreSQL？Regression 測試套件為用戶建立信心" />
 <link href="PostgreSQL-HOWTO-10.html" rel="chapter" title="10.資料庫保安" />
 <link href="PostgreSQL-HOWTO-11.html" rel="chapter" title="11.PostgreSQL 的前端 GUI 工具（圖像使用者界面）" />
 <link href="PostgreSQL-HOWTO-12.html" rel="chapter" title="12.PostgreSQL 的介面驅動程式" />
 <link href="PostgreSQL-HOWTO-13.html" rel="chapter" title="13.PostgreSQL 的 Perl 資料庫介面 (Database Interface, DBI) " />
 <link href="PostgreSQL-HOWTO-14.html" rel="chapter" title="14.PostgreSQL 管理工具 " />
 <link href="PostgreSQL-HOWTO-15.html" rel="chapter" title="15.PostgreSQL 用的中央處理器" />
 <link href="PostgreSQL-HOWTO-16.html" rel="chapter" title="16.只使用一個顯示器 (monitor) 來設定多台 PostgreSQL 電腦" />
 <link href="PostgreSQL-HOWTO-17.html" rel="chapter" title="17.PostgreSQL 的萬維網應用程式伺服器" />
 <link href="PostgreSQL-HOWTO-18.html" rel="chapter" title="18.PostgreSQL 的應用程式和工具" />
 <link href="PostgreSQL-HOWTO-19.html" rel="chapter" title="19.資料庫設計工具—實體關係圖 (Entity Relation Tool) 工具" />
 <link href="PostgreSQL-HOWTO-20.html" rel="chapter" title="20.PostgreSQL 的互聯網資料庫設計/完成工具—EARP" />
 <link href="PostgreSQL-HOWTO-21.html" rel="chapter" title="21.PHP Hypertext PreProcessor—PostgreSQL 的伺服器端 html 嵌入命令稿語言" />
 <link href="PostgreSQL-HOWTO-22.html" rel="chapter" title="22.PostgreSQL 的 Python 介面" />
 <link href="PostgreSQL-HOWTO-23.html" rel="chapter" title="23.PostgreSQL 和萬維網的閘路 (gateway) — WDB-P95" />
 <link href="PostgreSQL-HOWTO-24.html" rel="chapter" title="24.&quot;C&quot;, &quot;C++&quot;, ESQL/C 語言介面和 PostgreSQL 的逐位運算元 (Bitwise Operators)" />
 <link href="PostgreSQL-HOWTO-25.html" rel="chapter" title="25.PostgreSQL 的日文假名碼 (Kanji Code)" />
 <link href="PostgreSQL-HOWTO-26.html" rel="chapter" title="26.移植 PostgreSQL 到視窗 95 / 視窗 NT" />
 <link href="PostgreSQL-HOWTO-27.html" rel="chapter" title="27.通信論壇" />
 <link href="PostgreSQL-HOWTO-28.html" rel="chapter" title="28.文件和參考書" />
 <link href="PostgreSQL-HOWTO-29.html" rel="chapter" title="29.PostgreSQL 的技術支援" />
 <link href="PostgreSQL-HOWTO-30.html" rel="chapter" title="30.經濟和商業方面" />
 <link href="PostgreSQL-HOWTO-31.html" rel="chapter" title="31.其他資料庫的名單" />
 <link href="PostgreSQL-HOWTO-32.html" rel="chapter" title="32.萬維網搜尋提示" />
 <link href="PostgreSQL-HOWTO-33.html" rel="chapter" title="33.結論" />
 <link href="PostgreSQL-HOWTO-34.html" rel="chapter" title="34.FAQ—有關 PostgreSQL 的問題" />
 <link href="PostgreSQL-HOWTO-35.html" rel="chapter" title="35.本文件的其他格式" />
 <link href="PostgreSQL-HOWTO-36.html" rel="chapter" title="36.版權和授權" />
 <link href="PostgreSQL-HOWTO-37.html" rel="appendix" title="附錄甲—ANSI/ISO SQL 1992 語法 " />
 <link href="PostgreSQL-HOWTO-38.html" rel="appendix" title="附錄乙—初學者 SQL 導引 " />
 <link href="PostgreSQL-HOWTO-39.html" rel="appendix" title="附錄丙—Linux 快速安裝指引 " />
 <link href="PostgreSQL-HOWTO-40.html" rel="appendix" title="附錄丁—安裝 Midgard" />
 <meta http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html"  labels ratings (ca 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html"  labels ratings (n 0 s 0 v 0 l 0))'/>
 <link href="PostgreSQL-HOWTO.rdf" rel="meta" title="各章節的說明資訊" />
 <link href="../../style.css" rel="stylesheet" type="text/css" />
 <link href="PostgreSQL-HOWTO-10.html#ss10.1" rel="section" title="10.1 用戶認證 " />
 <link href="PostgreSQL-HOWTO-10.html#ss10.2" rel="section" title="10.2 依據主機控制存取" />
 <link href="PostgreSQL-HOWTO-10.html#ss10.3" rel="section" title="10.3 認證方法" />
 <link href="PostgreSQL-HOWTO-10.html#ss10.4" rel="section" title="10.4 存取控制" />
 <link href="PostgreSQL-HOWTO-10.html#ss10.5" rel="section" title="10.5 經 SSH 的保安 TCP/IP 連接" />
 <link href="PostgreSQL-HOWTO-10.html#ss10.6" rel="section" title="10.6 Kerberos 認證" />
 <link href="http://www.heimhardt.de/htdocs/ssh.html" rel="bookmark" title="ssh 的文件" />
</head> <body   > 
<table >
  <tr>
    <th colspan="3" class="HdTitle">HOWTO：Database-SQL-RDBMS
      HOWTO for Linux</th>
  </tr>
  <tr>
    <td class="TtdL"> <a href="PostgreSQL-HOWTO-9.html" accesskey="P">上一頁(P)</a> </td>
    <td class="TtdC">&nbsp;</td>
    <td class="TtdR"> <a href="PostgreSQL-HOWTO-11.html" accesskey="N">下一頁(N)</a> </td>
  </tr>
</table>
<hr />
<h1> 10. 資料庫保安 </h1>

<p>資料庫保安問題需在多個不同層面探討︰</p>
<ul>
<li> 資料庫檔案保護。資料庫的所有檔案都不淮 postgres
超級用戶以外的用戶讀取。</li>
<li> 據預設值，從用戶連接到資料庫伺服器只能透過本機的 UNIX 插座
(socket)，不是 TCP/IP 插座。伺服器需以 -i 選項啟動才能容許非本機客戶連接。</li>
<li> 客戶連接可以 IP 地址和 / 或用者名稱加以限制，只需修改 $PG_DATA
中的 pg_hba.conf 檔。</li>
<li> 可籍外部套件認證客戶連接。</li>
<li> 每位 Postgres 用戶都有一個使用者名稱和選擇性地擁有一個密碼。
預設值是用戶沒有權限寫入不是自己建立的資料庫。</li>
<li> 用戶可被編配到群組中，能否存取一個表格可以群組特權來限制。 </li>
</ul>
<h2><a name="ss10.1" id="ss10.1"></a>10.1 用戶認證
</h2>

<p>認證是後端伺服器和 postmaster 確保要求存取資料的用戶是否確為其人的過程。所有啟動
Postgres 的用者都與認證是後端伺服器和 postmaster pg_user
類別比較，以確定他們有權做想做的工作。
而用者真實身分的辨別工作以多個不同方法完成︰</p>
<ul>
<li> 在使用者 shell 中︰ 在使用者 shell
直接啟動的後端伺服器記下用者的（有效）使用者代號 (effective 
user-id)，之後作一次 setuid 來化身為 postgres。
有效使用者識別號會被用作存取控制的基礎。再沒有其他認證工作。</li>
<li> 來自網絡︰ 如果 Postgres 系統以分散式運行，任何人都可存取
postmaster 行程 (process) 的互聯網 TCP 埠。資料庫管理員需設定 $PGDATA
目錄中的 pg_hda.conf 檔，來指定不同主機連接不同資料庫時所用的認證系統。

請參閱 pg_hba.conf(5) （man 5 pg_hba.conf）
以了解不同認證系統。當然，根據主機來進行認證在 Unix
也不是毫無破碇。有決心的入侵者也可以偽裝自己所用的主機。這些保安問題不在
Postgres 的控制範圍。</li>
</ul>
<h2><a name="ss10.2" id="ss10.2"></a>10.2 依據主機控制存取
</h2>

<p>依據主機控制存取即 PostgreSQL
用於決定什麼客戶可存取資料庫和他們如何確認身份的過程。每個資料庫都有一個名為
pg_hba.conf 的檔案，在它的 $PGDATA
目錄中，它控制誰能存取資料庫。每個存取資料庫的用戶都要在 pg_hba.conf
中有相應的紀錄。否則所有來自該客戶的連接都會以"User authemtication
failed" 錯誤訊息被拒。</p>
<p>請參閱 pg_hba.conf(5) 的 man page（man 5 pg_hba.conf）。</p>
<p>pg_hba.conf 檔的基本格式是一組紀錄，一行一個。空行或以 hash
字母（#）開始的行則不理會。一個紀錄由一些用空格和 / 或 Tab 分開的欄位組成。</p>
<p>從客戶來的連接可經 Unix 插座或互聯網插座（即 TCP/IP）。來自 Unix
插座的連接用以下格式的記錄控制︰</p>
<pre class="sample">
local database authentication method
</pre>

<p>而
</p>
<p>database 指定本紀錄用於哪個資料庫。all
代表它適用於所有資料庫。</p>
<p>authentication method 指定用戶在使用 Unix 
插座時用來認證的方法。不同的方法容後詳述。</p>

<p>來自互聯網插座的連接用以下格式的記錄控制︰</p>
<p></p>
<pre class="sample">
host database TCP/IP-address TCP/IP-mask authentication method
</pre>
<p>TCP/IP 地址會 邏輯上 and'ed 到指定的 TCP/IP 罩和客戶的 
TCP/IP 地址。如兩者相等，這紀錄會用於這個連接。如果一個連接符合超過一個紀錄，
檔案中的第一個紀錄會被使用。不論 TCP/IP 地址還是 TCP/IP 
罩都是以分點的十進數格式 (dotted decimal notation) 
表達。如果一個連接和所有紀錄都不符，reject 認證方法將會被使用。（參閱
<a href="#auth_method">認證方法</a>）</p>
<h2> <a name="ss10.3" id="ss10.3"></a>10.3 認證方法 
</h2>

<p>Unix 和 TCP/IP 插座都支援以下認證方法︰</p>
<ul>
<li> trust
無條件地容許連接。</li>
<li> reject
無條件地拒絕連接。</li>
<li> crypt
問客戶端用者的密碼。它會經加密（使用 crypt(3)）和與 pg_shadow
表格的密碼比較。如果密碼相符，便容許連接。</li>
<li> password
問客戶端用者的密碼。它會原裝傳送和與 pg_shadow
表格的密碼比較。如果密碼相符，便容許連接。一個選擇性的密碼檔可在 password
關鍵字後出現。這樣密碼的配對會用這檔案，而不是 pg_shadow 檔案。請參閱
pg_passwd。</li>
</ul>
<p>以下認證方法只受 TCP/IP 插座支援︰</p>
<ul>
<li> krb4
用 Kerberos V4 來認證用戶。</li>
<li> krb5
用 Kerberos V4 來認證用戶。</li>
<li> ident
用客戶端的 ident 伺服器來認證用戶（RFC 1413）。在 ident
關鍵字後還可選擇性地指明一個映射，讓 ident 用戶名稱對應到 Postgres
用戶名稱。對應的關係儲存在 $PGDATA/pg_ident.conf 檔中。</li>
</ul>
<p>這裡有一些例子︰</p>
<pre class="sample">
# 信任所有來自 Unix 插座的連接。
local   trust
# 信任所有這部電腦經 TCP/IP 來的連接。
host    all 127.0.0.1   255.255.255.255     trust
# 我們討厭這部電腦。
host    all 192.168.0.10    255.255.255.0       reject
# 這部電腦不懂加密，所以我們要純文字的密碼。
host    all 192.168.0.3 255.255.255.0       password
# 這群電腦的其他成員都要提供加密了的密碼。
host    all 192.168.0.0 255.255.255.0       crypt

</pre>
<h2><a name="ss10.4" id="ss10.4"></a>10.4 存取控制
</h2>

<p>Postgres 提供了限制其他用家存取自己資料的機制。</p>
<ul>
<li> 資料庫超級用家 (Database superusers)
資料庫超級用家（即 pg_user.usesuper
設定為對的用家）自動通過以下兩項之外的所有存取控制︰pg_user.usecatupd
沒有設定為對的話不准手動更新系統目錄，摧毀系統目錄（或修改它的綱目 
(schema)）則永不准許。</li>
<li> 存取特權 (Access Privilege)
存取特權是用來限制讀、寫和設定類別 (class) 規則的權力，用 SQL 
grant/revoke(1) 來決定。</li>
<li> 移除類別和修改綱目
毀滅或修改現存類別的結構，如修改、丟棄表格，和丟棄索引，只能由類別的主人執行。
如上所述，這類動作不許用於系統目錄。</li>
</ul>
<h2><a name="ss10.5" id="ss10.5"></a>10.5 經 SSH 的保安 TCP/IP 連接
</h2>

<p>你可用 ssh 來加密客戶和 Postgres
伺服器間的網絡連接。做得正確的話，這樣可形成一個保安的網絡連接。</p>
<p><a href="http://www.heimhardt.de/htdocs/ssh.html">ssh 的文件</a>提供了大部份開始時需要的資料。以加深了解。逐步解釋只需兩步。</p>
<p>經 ssh 形成一條保安通道︰
逐步解釋只需兩步。</p>
<ul>
<li> 產生一條到後端電腦的通道，如下︰

<pre class="sample">
ssh -L 3333:wit.mcs.anl.gov:5432 postgres@wit.mcs.anl.gov
</pre>
</li>
<li> -L
參數後的第一個數字，33333，是你這方通道的埠號。第二個數字，
5432，是另一方的終點—後端的埠號。兩個埠數之間的名稱或地址屬於伺服器。
ssh 最後一個參數中用家自行選擇是否加上的用戶名稱也是。
沒有用戶名稱的話，ssh 會嘗試使用登入客戶端電腦的用戶名稱。
你可用任何伺服器電腦接受的用戶名稱，不一定要用和 PostgreSQL 有關的。</li>
<li> 你現在已開始了一個 ssh 時段，你把可你所用的電腦的 Postgres 
客戶連接到你前一步所定的埠號。如你使用 
psql，你要另一個介面，因為之前所用的一個已被 ssh 佔據。

<pre class="sample">
psql -h localhost -p 3333 -d mpw
</pre>
</li>
<li> 注意你要用 -h 參數使得你的客戶用 TCP 插座而不是 Unix
插座。如果你用 5432 作通道的終點你可略去埠的參數。</li>
</ul>
<h2><a name="ss10.6" id="ss10.6"></a>10.6 Kerberos 認證
</h2>

<p>Kerberos 是一個業界標準的保安認證系統，適用於經過公用網絡的分散式系統。</p>
<p>如何取得
Kerberos 認證系統並不隨同 Postgres 散佈。不同版本的 Kerberos
多以可供選擇的軟件的形式自作業系統廠商得到。此外，原程式碼的發行版本 
(distribution) 可自 MIT Project Athena 得到。</p>
<pre class="sample">
注意︰即使你使廠商提供了 Kerberos，你仍可能想用 MIT 
版，因為一些廠商的版本被故意弄壞以致不能和 MIT 版本合作。
</pre>
<p>有關 Kerberos 的查詢可提交你的廠商或 MIT Project Athena。注意
FAQLs（常問問題名單，Frequently-Asked Questions Lists) 會被定時寄至 Kerberos
通信論壇（寄信去訂閱），和 USENET 新聞組。</p>
<p>安裝︰
安裝 Kerberos 在 Kerberos Installation Notes 中已詳細說明。要確定伺服器鍵碼檔
(key file)（srvtab 或 keytab）可被 postgres
用戶讀到。籍設定 src/Makefile.global 檔的 KRBVERS 變數，Postgres 
或其客戶程式可編譯為使用 MIT Kerberos 通訊協定的第四或五版。你也可改變 
Postgres 期望找到相關函式庫、標頭檔和自己的伺服器鍵碼檔的位置。編譯完後，
Postgres 要登記為一個 Kerberos 服務。請參閱 Kerberos  Operations Notes 和相關 
manual pages 以取得有關登記服務的詳情。</p>
<p>操作︰
安裝之後，Postgres 在各方面應如一般 Kerberos
服務運作。要知道認證的使用方法，請參閱 PostgreSQL
User's Guide 有關
postmaster 和 psql 的章節。</p>
<p>在 Kerberos 第五版掛釣
(hooks)，對用戶和服務命名作了以下假設（也請參閱以下表格）。</p>
<ul>
<li> 用戶的主要名稱 (principal names，anames) 第一個部份中假設含有 Unix /
Postgres 用戶名稱。</li>
<li> Postgres
服務假設有兩個部份，服務名稱和主機名稱。後者如同第四版的格式
（即除去所有域名的部分）。</li>
</ul>
<pre class="sample">
                表格︰Kerberos 參數例子
 ------------------------------------------------------
 參數       例子 
 ------------------------------------------------------
 user       frew@S2K.ORG
 user       aoki/HOST=miyu.S2K.Berkeley.EDU@S2K.ORG
 host       postgres_dbms/ucbvax@S2K.ORG
 ------------------------------------------------------
</pre>
<hr />
<div> <a href="http://validator.w3.org/check/referer"><img src="../../../valid-xhtml10.png"  alt="符合 XHTML 1.0" class="ImgLogo"/></a> <a href="http://jigsaw.w3.org/css-validator/"><img class="ImgLogo" src="../../../vcss.png"  alt="符合 CSS"/></a> <a href="http://www.icra.org/_en/"><img src="../../../icra_sw.gif" title="網路內容分級協會" alt="網路內容分級協會" class="ImgLogo"/></a></div>
</body>
</html>
