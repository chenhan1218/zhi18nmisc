<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="zh-TW" xml:lang="zh-TW" xmlns="http://www.w3.org/1999/xhtml">
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
 
 <title>如何取得，安裝，設定 shadow 密碼: 安裝</title>
 <link href="Shadow-Password-HOWTO-6.html" rel="next" title="6. 其他你需要升級(upgrade)或補強(patch)程式" />
 <link href="Shadow-Password-HOWTO-4.html" rel="previous" title="4. 編譯程式" />
 <link href="../../style.css" rel="stylesheet" type="text/css" />
  <link href="index.html" rel="start" title="HOWTO：Linux Shadow Password" />
 <link href="index.html#content" rel="contents" />
 <link href="Shadow-Password-HOWTO-1.html" rel="chapter" title="1.簡介" />
 <link href="Shadow-Password-HOWTO-2.html" rel="chapter" title="2.為何 shadow 你的 passwd 檔?" />
 <link href="Shadow-Password-HOWTO-3.html" rel="chapter" title="3.取得 Shadow Suite." />
 <link href="Shadow-Password-HOWTO-4.html" rel="chapter" title="4.編譯程式" />
 <link href="Shadow-Password-HOWTO-5.html" rel="chapter" title="5.安裝" />
 <link href="Shadow-Password-HOWTO-6.html" rel="chapter" title="6.其他你需要升級(upgrade)或補強(patch)程式" />
 <link href="Shadow-Password-HOWTO-7.html" rel="chapter" title="7.將 Shadow Suite 放進來使用。" />
 <link href="Shadow-Password-HOWTO-8.html" rel="chapter" title="8.加入 shadow 支援 C 語言" />
 <link href="Shadow-Password-HOWTO-9.html" rel="chapter" title="9.常問問題及答案" />
 <link href="Shadow-Password-HOWTO-10.html" rel="chapter" title="10.版權聲明(暫不翻譯)" />
 <link href="Shadow-Password-HOWTO-11.html" rel="chapter" title="11.Miscellaneous and Acknowledgments." />
 <link href="http://tldp.org/HOWTO/Shadow-Password-HOWTO.html" rel="alternate" title="原版" />
 <meta http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html"  labels ratings (ca 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html"  labels ratings (n 0 s 0 v 0 l 0))'/>
 <link href="Shadow-Password-HOWTO.rdf" rel="meta" title="各章節的說明資訊" />
 <link href="Shadow-Password-HOWTO-5.html#ss5.1" rel="section" title="5.1 手邊準備一個開機片" />
 <link href="../Bootdisk-HOWTO/" rel="bookmark" title="HOWTO：The Linux Bootdisk(中譯版)" />
 <link href="Shadow-Password-HOWTO-5.html#ss5.2" rel="section" title="5.2 移除複製的 man pages " />
 <link href="Shadow-Password-HOWTO-5.html#ss5.3" rel="section" title="5.3 執行 make install " />
 <link href="Shadow-Password-HOWTO-5.html#ss5.4" rel="section" title="5.4 執行 pwconv" />
 <link href="Shadow-Password-HOWTO-5.html#ss5.5" rel="section" title="5.5 重新命名 npasswd 和 nshadow" />
</head> <body  >
<table >
  <tr>
    <th colspan="3" class="HdTitle">HOWTO：Linux
      Shadow Password</th>
  </tr>
  <tr>
    <td class="TtdL"> <a href="Shadow-Password-HOWTO-4.html" accesskey="P">上一頁(P)</a> </td>
    <td class="TtdC">&nbsp;</td>
    <td class="TtdR"> <a href="Shadow-Password-HOWTO-6.html" accesskey="N">下一頁(N)</a> </td>
  </tr>
</table> 


<hr />
<h1>5. 安裝</h1>

<h2><a name="ss5.1" id="ss5.1"></a>5.1 手邊準備一個開機片
</h2>

<p>如果真的發生嚴重錯誤，有個開機磁片之有用的。如果你要 boot/root 合併的安裝，你可以
參考
<a href="../Bootdisk-HOWTO/">Bootdisk-HOWTO</a> 以製作 root 開機之開機片。</p>


<h2><a name="ss5.2" id="ss5.2"></a>5.2 移除複製的 man pages
</h2>

<p>你也應該將操作手冊更新，即使你很厲害到足以不用備份安裝 Shadow Suite，你仍然要將
將舊的操作手冊移除，因為新版的操作手冊無法正常的覆蓋舊版本。</p>
<p>你可以使用一個組合： <code>man -aW 命令</code> 和 <code>locate 命令</code> 尋找需備移除
的操作手冊。在你執行 <code>make install</code> 前找出較舊版本比較容易。</p>
<p>如果你使用 Slackware 3.0 版本，然後你要移除的操作手冊是：</p>
<ul>
<li>/usr/man/man1/chfn.1.gz</li>
<li>/usr/man/man1/chsh.1.gz</li>
<li>/usr/man/man1/id.1.gz</li>
<li>/usr/man/man1/login.1.gz</li>
<li>/usr/man/man1/passwd.1.gz</li>
<li>/usr/man/man1/su.1.gz</li>
<li>/usr/man/man5/passwd.5.gz</li>
</ul>

<p>在 <code>/var/man/cat[1-9]</code> 次目錄也有相同的名字需要被刪除。</p>

<h2><a name="ss5.3" id="ss5.3"></a>5.3 執行 make install
</h2>

<p>現在你已經準備要輸入： (以 root 權限執行)
</p>
<pre class="sample">
make install
</pre>


<p>這將安裝最新和更新程式且修復檔案許可權。它也會安裝操作手冊。</p>
<p>這也將在安裝時考慮將 Shadow Suite 包含檔案放在正確的位置 <code>/usr/include/shadow</code> 。</p>

<p>使用 BETA 套件，你需要手動複製 <code>login.defs</code> 這個檔到 <code>/etc</code> 這個目錄下，
而且要確認只有 <em>root</em> 權限可以改變它。</p>
<p>
</p>
<pre class="sample">
cp login.defs /etc
chmod 700 /etc/login.defs
</pre>


<p>這個檔案是 <em>簽入</em> 程式的 configuration file。 你應該檢查跟確定這個檔的改變狀況。
這是你決定哪個  tty 的 root 可以從哪裡簽入和設定其他安全方針的地方(像預設密碼的到期日)。</p>

<h2><a name="ss5.4" id="ss5.4"></a>5.4 執行 pwconv
</h2>

<p>接下來的步驟是執行 <code>pwconv</code>。  這也需以 <em>root</em>執行且最好在 <code>/etc</code> 
目錄下執行：
</p>
<pre class="sample">
cd /etc
/usr/sbin/pwconv
</pre>


<p><code>pwconv</code> 擷取你的 <code>/etc/passwd</code> 檔且刪除某些欄位為了建立兩個檔案：
<code>/etc/npasswd</code> 和 <code>/etc/nshadow</code>.</p>
<p>一個 <code>pwunconv</code> 也提供你建立一個 <code>/etc/passwd</code> 和 <code>/etc/shadow</code> 
組合的正常 <code>/etc/passwd</code> 檔案。</p>

<h2><a name="ss5.5" id="ss5.5"></a>5.5 重新命名 npasswd 和 nshadow
</h2>

<p>現在你已經執行 <code>pwconv</code> ，而且你已經建立 <code>/etc/npasswd</code> 和
<code>/etc/nshadow</code> 檔案。這需要複製到 <code>/etc/passwd</code> 和 <code>/etc/shadow</code>
檔。 我們也需要複製原始 <code>/etc/passwd</code> 檔，而且確定只有 root 可以讀它。
我們將該檔案放在 root 得根目錄：</p>
<p>
</p>
<pre class="sample">
cd /etc
cp passwd ~passwd
chmod 600 ~passwd
mv npasswd passwd
mv nshadow shadow
</pre>


<p>你也應該確定檔案的擁有者跟存取權限是正確的。 如果你將要使用 <em>X-Windows</em> ，
<code>xlock</code> 和 <code>xdm</code> 可能需要讀取 <code>shadow</code> 檔(但需不要寫入該檔)。</p>
<p>有兩個方法可以做。 你可以設定 <code>xlock</code> 的 suid 是 root (<code>xdm</code>  通常以
root 權限執行)。 或者你可以使 root 成為 <code>shadow</code> 的群組可以擁有 <code>shadow</code> 檔
，但是在作這之前，要確定你已經有個 shadow group (可以在 <code>/etc/group</code> 檔看到)。
不應改有任何使用者真的在  shadow group 。</p>

<pre class="sample">
chown root.root passwd
chown root.shadow shadow
chmod 0644 passwd
chmod 0640 shadow
</pre>


<p>你的系統現在有 shadow 的密碼檔囉。 你現在 <em>應該</em> 重開一個終端機視窗和確認你
可以簽入(login)。</p>
<p><em>請馬上確實的作這件事！</em></p>
<p>如過你不能，可能某些事情有錯誤囉！ 為了要回到 to a non-shadowed 狀態，請作下列步驟：</p>

<pre class="sample">
cd /etc
cp ~passwd passwd
chmod 644 passwd
</pre>


<p>你將重新儲存這些檔案到先前你儲存它們的正確位置。</p>


<hr />
<table >
  <tr>
    <td class="BtdL"> <a href="Shadow-Password-HOWTO-4.html" accesskey="P">上一頁(P)</a> </td>
    <td class="BtdC"> <a href="index.html" accesskey="H">目錄(H)</a> </td>
    <td class="BtdR"> <a href="Shadow-Password-HOWTO-6.html">下一頁(N)</a> </td>
  </tr>
  <tr>
    <td class="BtdL">編譯程式</td>
    <td class="BtdC"><a href="Shadow-Password-HOWTO-5.html"  accesskey="T">到頂層(T)</a></td>
    <td class="BtdR">其他你需要升級(upgrade)或補強(patch)程式</td>
  </tr>
</table>
<div> <a href="http://validator.w3.org/check/referer"><img src="../../../valid-xhtml10.png"  alt="符合 XHTML 1.0" class="ImgLogo"/></a> <a href="http://jigsaw.w3.org/css-validator/"><img class="ImgLogo" src="../../../vcss.png"  alt="符合 CSS"/></a> <a href="http://www.w3.org/WAI/WCAG1AA-Conformance" title="Explanation of Level Double-A Conformance"><img class="ImgLogo" src="../../../wcag1AA.gif" alt="Level Double-A conformance icon,  W3C-WAI Web Content Accessibility Guidelines 1.0"/></a> <a href="http://www.w3.org/RDF/" title="RDF 資源描述架構"><img  src="../../../rdf.gif" class="ImgLogo" alt="表示該網頁支援資源描述架構"/></a> <a href="http://www.icra.org/_en/"><img src="../../../icra_sw.gif" title="網路內容分級協會" alt="網路內容分級協會" class="ImgLogo"/></a></div>


  </body>
</html>
