<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="zh-TW" xml:lang="zh-TW" xmlns="http://www.w3.org/1999/xhtml">
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
 
 <title>如何取得，安裝，設定 shadow 密碼: 其他你需要升級(upgrade)或補強(patch)程式</title>
 <link href="Shadow-Password-HOWTO-7.html" rel="next" title="7. 將 Shadow Suite 放進來使用。" />
 <link href="Shadow-Password-HOWTO-5.html" rel="previous" title="5. 安裝" />
 <link href="../../style.css" rel="stylesheet" type="text/css" />
  <link href="index.html" rel="start" title="HOWTO：Linux Shadow Password" />
 <link href="index.html#content" rel="contents" />
 <link href="Shadow-Password-HOWTO-1.html" rel="chapter" title="1.簡介" />
 <link href="Shadow-Password-HOWTO-2.html" rel="chapter" title="2.為何 shadow 你的 passwd 檔?" />
 <link href="Shadow-Password-HOWTO-3.html" rel="chapter" title="3.取得 Shadow Suite." />
 <link href="Shadow-Password-HOWTO-4.html" rel="chapter" title="4.編譯程式" />
 <link href="Shadow-Password-HOWTO-5.html" rel="chapter" title="5.安裝" />
 <link href="Shadow-Password-HOWTO-6.html" rel="chapter" title="6.其他你需要升級(upgrade)或補強(patch)程式" />
 <link href="Shadow-Password-HOWTO-7.html" rel="chapter" title="7.將 Shadow Suite 放進來使用。" />
 <link href="Shadow-Password-HOWTO-8.html" rel="chapter" title="8.加入 shadow 支援 C 語言" />
 <link href="Shadow-Password-HOWTO-9.html" rel="chapter" title="9.常問問題及答案" />
 <link href="Shadow-Password-HOWTO-10.html" rel="chapter" title="10.版權聲明(暫不翻譯)" />
 <link href="Shadow-Password-HOWTO-11.html" rel="chapter" title="11.Miscellaneous and Acknowledgments." />
 <link href="http://tldp.org/HOWTO/Shadow-Password-HOWTO.html" rel="alternate" title="原版" />
 <meta http-equiv="PICS-Label" content='(PICS-1.1 "http://www.icra.org/ratingsv02.html"  labels ratings (ca 1 lz 1 nz 1 oz 1 vz 1) "http://www.rsac.org/ratingsv01.html"  labels ratings (n 0 s 0 v 0 l 0))'/>
 <link href="Shadow-Password-HOWTO.rdf" rel="meta" title="各章節的說明資訊" />
 <link href="ftp://sunsite.unc.edu/pub/Linux/system/ Admin/accounts/adduser.shadow-1.4.tgz" rel="bookmark" title="/sbin/adduser" />
 <link href="Shadow-Password-HOWTO-6.html#ss6.1" rel="section" title="6.1 Slackware adduser 程式 " />
 <link href="Shadow-Password-HOWTO-6.html#ss6.2" rel="section" title="6.2 wu_ftpd Server " />
 <link href="http://bach.cis.temple.edu/linux/linux-security/Linux-Security-FAQ/Linux-wu.ftpd-2.4-Update.html" rel="bookmark" title="Linux security home page" />
 <link href="ftp://sunsite.unc.edu/pub/Linux/system/Network/file-transfer/wu-ftpd-2.4-fixed.tar.gz" rel="工具" title="wu-ftp-2.4-fixed.tar.gz" />
 <link href="Shadow-Password-HOWTO-6.html#ss6.3" rel="section" title="6.3 標準 ftpd" />
 <link href="ftp://sunsite.unc.edu/pub/Linux/system/Network/file-transfer/ftpd-shadow-nis.tgz" rel="工具" title="ftpd-shadow-nis.tgz" />
 <link href="Shadow-Password-HOWTO-6.html#ss6.4" rel="section" title="6.4 pop3d (Post Office Protocol 3)" />
 <link href="ftp://sunsite.unc.edu/pub/Linux/system/Mail/pop/pop3d-1.00.4.linux.shadow.tar.gz" rel="工具" title="pop3d-1.00.4.linux.shadow.tar.gz" />
 <link href="ftp://sunsite.unc.edu/pub/Linux/system/Mail/pop/pop3d+shadow+elf.tar.gz" rel="工具" title="pop3d+shadow+elf.tar.gz" />
 <link href="Shadow-Password-HOWTO-6.html#ss6.5" rel="section" title="6.5 xlock" />
 <link href="ftp://sunsite.unc.edu/pub/Linux/X11/xutils/screensavers/xlockmore-3.7.tgz" rel="bookmark" title="xlockmore-3.5.tgz" />
 <link href="Shadow-Password-HOWTO-6.html#ss6.6" rel="section" title="6.6 xdm" />
 <link href="ftp://sunsite.unc.edu/pub/Linux/X11/xutils/xdm.tar.gz" rel="工具" title="xdm.tar.gz" />
 <link href="Shadow-Password-HOWTO-6.html#ss6.7" rel="section" title="6.7 sudo" />
 <link href="ftp://sunsite.unc.edu/pub/Linux/system/Admin/sudo-1.2-shadow.tgz" rel="工具" title="sudo 支援 shadow suite " />
 <link href="Shadow-Password-HOWTO-6.html#ss6.8" rel="section" title="6.8 imapd (E-Mail [pine package])" />
 <link href="Shadow-Password-HOWTO-6.html#ss6.9" rel="section" title="6.9 pppd (Point-to-Point Protocol Server)" />
</head> <body  >
<table >
  <tr>
    <th colspan="3" class="HdTitle">HOWTO：Linux
      Shadow Password</th>
  </tr>
  <tr>
    <td class="TtdL"> <a href="Shadow-Password-HOWTO-5.html" accesskey="P">上一頁(P)</a> </td>
    <td class="TtdC">&nbsp;</td>
    <td class="TtdR"> <a href="Shadow-Password-HOWTO-7.html" accesskey="N">下一頁(N)</a> </td>
  </tr>
</table> 

<hr />
<h1>6. 其他你需要升級(upgrade)或補強(patch)程式</h1>

<p>即使 shadow suite 對大部分需要存取密碼檔的程式可以包含更新程式，但是仍有一些需要
存取密碼檔的額外程式在系統中。</p>
<p>如果你正執行 <em>Debian 版本</em>  (或者即使你不是)，你可以找到 Debian 需要 rebuild 
的原始碼：
ftp://ftp.debian.org/debian/stable/source/</p>
<p>這節剩餘的部分在討論更新 <code>adduser</code>, <code>wu_ftpd</code>, <code>ftpd</code>,
<code>pop3d</code>, <code>xlock</code>,<code>xdm</code> 和 <code>sudo</code> 程式以便於讓這些程式支援
shadow suite。</p>
<p>請看 
<a href="Shadow-Password-HOWTO-8.html#sec-adding">Adding Shadow Support to a C program</a> 這節，主要是在
討論如何將 shadow 支援放到其他需要程式(雖然這些程式需要以 SUID root 執行或 SGID shadow
需正確存取 shadow 檔)。</p>

<h2><a name="ss6.1" id="ss6.1"></a>6.1 Slackware adduser 程式
</h2>

<p>Slackware 版本包含一個新增使用者的交互程式叫做 <code><a href="ftp://sunsite.unc.edu/pub/Linux/system/%20Admin/accounts/adduser.shadow-1.4.tgz">/sbin/adduser</a></code>。能夠在網路上找到該程式的 shadow
版本。</p>
<p>我很鼓勵你使用 <em>Shadow Suite</em> 供應的程式(例如<code>useradd</code>, <code>usermod</code>, 
和 <code>userdel</code>) 來取代 slackware 的<code>adduser</code> 程式。 它們只需花一點時間學習
，但是它將值得的，因為你可以看到更多控制和在正確展現鎖住 <code>/etc/passwd</code> 和 
<code>/etc/shadow</code> 的檔案(<code>adduser</code> 就沒有辦法囉)。</p>

<p>參考
<a href="Shadow-Password-HOWTO-7.html#sec-work">Putting the Shadow Suite to use</a> 該節得到更多相關資訊。</p>

<p>但是如果你已經擁有囉，接下來是你要做的部分：</p>
<pre class="sample">
tar -xzvf adduser.shadow-1.4.tar.gz
cd adduser
make clean
make adduser
chmod 700 adduser
cp adduser /sbin
</pre>



<h2><a name="ss6.2" id="ss6.2"></a>6.2 wu_ftpd Server
</h2>

<p>大部分的 Linux 系統都有 <code>wu_ftpd</code> server。 如果你的版本沒有附帶 shadow 安裝，
那麼你的 <code>wu_ftpd</code> 就沒有辦法對 shadow 編譯。 <code>wu_ftpd</code> 是從 
<code>inetd/tcpd</code> 開始且以 <em>root</em> 權限執行的程式。 如果你正在跑一個舊版的
<code>wu_ftpd</code> daemon， 無論如何你將要更新它因為較舊版本有 bug 將危及 <em>root</em> 
權限。(參考 
<a href="http://bach.cis.temple.edu/linux/linux-security/Linux-Security-FAQ/Linux-wu.ftpd-2.4-Update.html">Linux security home page</a>
得到更多相關資訊)。</p>

<p>幸運的是你只需要取的有嵌入 shaow 的原始碼和重新編譯就可以囉！</p>
<p>如果你不是正在執行 ELF 系統， <code>wu_ftp</code> server 可以從 Sunsite 網址
<a href="ftp://sunsite.unc.edu/pub/Linux/system/Network/file-transfer/wu-ftpd-2.4-fixed.tar.gz">wu-ftp-2.4-fixed.tar.gz</a> 找到。</p>
<p>當你獲得這個 server，把它放在 <code>/usr/src</code>目錄，然後輸入：</p>
<pre class="sample">
cd /usr/src
tar -xzvf wu-ftpd-2.4-fixed.tar.gz
cd wu-ftpd-2.4-fixed
cp ./src/config/config.lnx.shadow ./src/config/config.lnx
</pre>

<p>然後編輯 <code>./src/makefiles/Makefile.lnx</code>，和改變
</p>
<pre class="sample">
LIBES    = -lbsd -support
</pre>

 
<p>這一行到：</p>
<pre class="sample">
LIBES    = -lbsd -support -lshadow
</pre>
<p>現在你已經準備好執行 script 建立跟安裝：</p>
<pre class="sample">
cd /usr/src/wu-ftpd-2.4-fixed
/usr/src/wu-ftp-2.4.fixed/build lnx
cp /usr/sbin/wu.ftpd /usr/sbin/wu.ftpd.old
cp ./bin/ftpd /usr/sbin/wu.ftpd
</pre>

 <p>這是用在 Linux shadow configuration file、編譯和安裝 server。</p>
<p>在我的 Slackware 2.3 系統，我也需要在執行前作下列步驟：</p>
<p><code>build</code>:
</p>
<pre class="sample">
cd /usr/include/netinet
ln -s in_systm.h in_system.h
cd -
</pre>

<p>在 ELF 系統下會有編譯問題的報告，但是下一版的 Beta 版則可以正確的執行。
可以從 
<a href="ftp://tscnet.com/pub/linux/network/ftp/wu-ftpd-2.4.2-beta-10.tar.gz">wu-ftp-2.4.2-beta-10.tar.gz</a> 找到。</p>
<p>當你獲得這個 server，把它放在 <code>/usr/src</code>目錄，然後輸入：
</p>
<pre class="sample">
cd /usr/src
tar -xzvf wu-ftpd-2.4.2-beta-9.tar.gz
cd wu-ftpd-beta-9
cd ./src/config
</pre>

<p>然後編輯 <code>config.lnx</code>，和改變：
</p>
<pre class="sample">
#undef SHADOW.PASSWORD
</pre>


<p>這一行到：</p>
<pre class="sample">
#define SHADOW.PASSWORD
</pre>


<p>然後，</p>
<pre class="sample">
cd ../Makefiles
</pre>


<p>且編輯 <code>Makefile.lnx</code> 檔和改變

</p>
<pre class="sample">
LIBES = -lsupport -lbsd # -lshadow
</pre>


<p>這一行到：</p>
<pre class="sample">
LIBES = -lsupport -lbsd -lshadow
</pre>


<p>然後建立(build)和安裝(install)：</p>
<pre class="sample">
cd ..
build lnx
cp /usr/sbin/wu.ftpd /usr/sbin/wu.ftpd.old
cp ./bin/ftpd /usr/sbin/wu.ftpd
</pre>

 <p>註：你應該檢查你的 <code>/etc/inetd.conf</code> 檔來確認你的 wu.ftpd server 是不是真的活著。
有些版本可能將  server daemons 放在不同的地方或用不同的名字表示。</p>

<h2><a name="ss6.3" id="ss6.3"></a>6.3 標準 ftpd
</h2>

<p>如果你正在執行標準的 <code>ftpd</code> server，我將建議你更新 <code>wu_ftpd</code> server。
離開上述的 bug ，系統會比較安全。</p>
<p>如果你堅持在標準模式，或者你需要 <em>NIS</em> 支援，在 Sunsite  
<a href="ftp://sunsite.unc.edu/pub/Linux/system/Network/file-transfer/ftpd-shadow-nis.tgz">ftpd-shadow-nis.tgz</a> 有參考資料。</p>

<h2><a name="ss6.4" id="ss6.4"></a>6.4 pop3d (Post Office Protocol 3)
</h2>

<p>如果你需要支援第三版 <em>Post Office Protocol (POP3)</em>，你將需要重新編譯 <code>pop3d</code>
程式。 <code>pop3d</code> 可以透過 <code>inetd/tcpd</code> 以 <code>root</code> 權限正常的執行。</p>
<p>從 Sunsite 有兩個版本可以獲得： 
<a href="ftp://sunsite.unc.edu/pub/Linux/system/Mail/pop/pop3d-1.00.4.linux.shadow.tar.gz">pop3d-1.00.4.linux.shadow.tar.gz</a>
和
<a href="ftp://sunsite.unc.edu/pub/Linux/system/Mail/pop/pop3d%2Bshadow%2Belf.tar.gz">pop3d+shadow+elf.tar.gz</a></p>
<p>這兩個都很簡單可以安裝。</p>

<h2><a name="ss6.5" id="ss6.5"></a>6.5 xlock
</h2>


<p>如果你安裝 shadow suite，然後執行 <em>X Windows System</em> 和  
lock 螢幕沒以更新你的 <code>xlock</code> 檔， 你將必須使用 <code>CNTL-ALT-Fx</code> 去切換
另一個 <em>tty</em>，簽入(login)和殺掉(kill) <code>xlock</code> process 
(或使用 <code>CNTL-ALT-BS</code> 殺掉 X server)。
很幸運的這也很容易可以更新你的 <code>xlock</code> 程式。</p>
<p>如果你正執行 XFree86 Versions 3.x.x，且正正確使用
<code>xlockmore</code> (是一個很棒的螢幕保護程式).
這個套件支援 <em>shadow</em>，只要重新編譯即可。如果你有任何較老的 <code>xlock</code>
版本，我建議你更新下列版本：</p>
<p><code><a href="ftp://sunsite.unc.edu/pub/Linux/X11/xutils/screensavers/xlockmore-3.7.tgz">xlockmore-3.5.tgz</a></code> 。</p>
<p>基本上這是你所要的。</p>
<p>擷取 <code>xlockmore-3.7.tgz</code> ，並將它放在 <code>/usr/src</code> 目錄並解壓縮：
</p>
<pre class="sample">
tar -xzvf xlockmore-3.7.tgz
</pre>

<p>編輯這個檔： <code>/usr/X11R6/lib/X11/config/linux.cf</code>, 和改變
</p>
<pre class="sample">
#define HasShadowPasswd    NO

這一行到：

#define HasShadowPasswd    YES
</pre>

<p>然後建立可執行檔：
</p>
<pre class="sample">
cd /usr/src/xlockmore
xmkmf
make depend
make
</pre>

<p>然後搬移所以檔案到正確目錄且更新檔案擁有者及執行權限：</p>
<pre class="sample">
cp xlock /usr/X11R6/bin/
cp XLock /var/X11R6/lib/app-defaults/
chown root.shadow /usr/X11R6/bin/xlock
chmod 2755 /usr/X11R6/bin/xlock
chown root.shadow /etc/shadow
chmod 640 /etc/shadow
</pre>

<p>你的 xlock 將可以正確的運作囉！</p>

<h2><a name="ss6.6" id="ss6.6"></a>6.6 xdm
</h2>

<p><code>xdm</code> 是一個可以表示在 X-Windows 簽入畫面的程式。某些系統開始 <code>xdm</code> 
當系統被告知道一個特定的執行水準(參考 <code>/etc/inittab</code>)。</p>

<p>伴隨著 <em>Shadow Suite</em> 安裝， <code>xdm</code> 需要被更新。
很幸運的這也很容易可以更新你的 <code>xdm</code> 程式。</p>


<p><code><a href="ftp://sunsite.unc.edu/pub/Linux/X11/xutils/xdm.tar.gz">xdm.tar.gz</a></code> 。</p>
<p>擷取 <code>xdm.tar.gz</code> 檔並將它放在 <code>/usr/src</code>目錄然後解壓縮：
</p>
<pre class="sample">
tar -xzvf xdm.tar.gz
</pre>

<p>編輯這個檔： <code>/usr/X11R6/lib/X11/config/linux.cf</code>，且改變
</p>
<pre class="sample">
#define HasShadowPasswd    NO

這一行到：

#define HasShadowPasswd    YES
</pre>

<p>然後建立可執行檔：
</p>
<pre class="sample">
cd /usr/src/xdm
xmkmf
make depend
make
</pre>

<p>然後搬移所有檔案正確目錄：
</p>
<pre class="sample">
cp xdm /usr/X11R6/bin/
</pre>

<p><code>xdm</code> 以 <em>root</em> 權限在執行，所以你不需要改變檔案存取權限。</p>


<h2><a name="ss6.7" id="ss6.7"></a>6.7 sudo
</h2>

<p><code>sudo</code> 程式允許系統管理員讓使用者可以以 root 權限正常的執行程式。
這是非常方便的因為它可以限制管理者執行 root 帳號本身權限，還可以允許使用者作
像 mounte drives 的事情。</p>
<p><code>sudo</code> 需要讀取密碼因為在執行時需確認使用者密碼。 <code>sudo</code> 已經執行 SUID root，
所以存取 <code>/etc/shadow</code> 黨不是問題。</p>
<p><code>也能取得 <a href="ftp://sunsite.unc.edu/pub/Linux/system/Admin/sudo-1.2-shadow.tgz">sudo</a></code> 支援 shadow suite 。</p>
<p><em>警告</em>：當你安裝 <code>sudo</code> 你的 <code>/etc/sudoers</code> 檔將取代預設值，所以你
需要備份原始程式。如果你有家任何設定在預設程式，你可能要編輯 Makefile 且移除複製該檔到
<code>/etc</code> 的這行。</p>

<p>該套件已經對 shadow 進行設定，所以只要重新編譯該套件即可 (把它放在 <code>/usr/src</code> 目錄)：
</p>
<pre class="sample">
cd /usr/src
tar -xzvf sudo-1.2-shadow.tgz
cd sudo-1.2-shadow
make all
make install
</pre>

<h2><a name="ss6.8" id="ss6.8"></a>6.8 imapd (E-Mail [pine package])
</h2>

<p><code>imapd</code> 是一個像 <code>pop3d</code> 的 email server。 
<code>imapd</code> 隨著 <em>Pine E-mail</em> 套件發生。 其操作手冊在介紹該套件時即包含
shadow 支援。然而，我發現這不全然正確。 再加上在編譯時加上  <code>libshadow.a</code> 函式庫
和該套件結合 build script / Makefile 是非常不容易的。所以對 <code>imapd</code> 加入 shadow
支援是不太可能的。</p>

<p>如果有任何答案，可以 Email 給我，我會將該解答放到這裡。</p>

<h2><a name="ss6.9" id="ss6.9"></a>6.9 pppd (Point-to-Point Protocol Server)
</h2>

<p>pppd server 可以使用幾種權限設定：
<em>Password Authentication Protocol</em> (PAP) 和 <em>Cryptographic
Handshake Authentication Protocol</em> (CHAP)。   pppd server 從
<code>/etc/ppp/chap-secrets</code> 和/或 <code>/etc/ppp/pap-secrets</code> 檔讀取密碼字串。
如果你正使用預設 pppd 的執行，就沒有必要再重新安裝 pppd 。</p>
<p>pppd 以允許你使用 <em>login</em> 參數。 如果 <em>login</em> 選項被選取，
pppd 將使用 <code>/etc/passwd</code> 檔的帳號密碼給 <em>PAP</em>. 當然在不久密碼檔會是 
shadowedm。pppd-1.2.1d 檔已經加入對 shadow 的支援。</p>

<p>下一節加入支援 shadow 的範例是針對
<code>pppd-1.2.1d</code> (一個較老版本的 pppd).</p>
<p><code>pppd-2.2.0</code> 版就已經包括 shadow 支援囉。</p>

<hr />
<table >
  <tr>
    <td class="BtdL"> <a href="Shadow-Password-HOWTO-5.html" accesskey="P">上一頁(P)</a> </td>
    <td class="BtdC"> <a href="index.html" accesskey="H">目錄(H)</a> </td>
    <td class="BtdR"> <a href="Shadow-Password-HOWTO-7.html">下一頁(N)</a> </td>
  </tr>
  <tr>
    <td class="BtdL">安裝</td>
    <td class="BtdC"><a href="Shadow-Password-HOWTO-6.html"  accesskey="T">到頂層(T)</a></td>
    <td class="BtdR">將 Shadow Suite 放進來使用</td>
  </tr>
</table>
<div> <a href="http://validator.w3.org/check/referer"><img src="../../../valid-xhtml10.png"  alt="符合 XHTML 1.0" class="ImgLogo"/></a> <a href="http://jigsaw.w3.org/css-validator/"><img class="ImgLogo" src="../../../vcss.png"  alt="符合 CSS"/></a> <a href="http://www.w3.org/WAI/WCAG1AA-Conformance" title="Explanation of Level Double-A Conformance"><img class="ImgLogo" src="../../../wcag1AA.gif" alt="Level Double-A conformance icon,  W3C-WAI Web Content Accessibility Guidelines 1.0"/></a> <a href="http://www.w3.org/RDF/" title="RDF 資源描述架構"><img  src="../../../rdf.gif" class="ImgLogo" alt="表示該網頁支援資源描述架構"/></a> <a href="http://www.icra.org/_en/"><img src="../../../icra_sw.gif" title="網路內容分級協會" alt="網路內容分級協會" class="ImgLogo"/></a></div>

  </body>
</html>
