<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="zh-TW" xml:lang="zh-TW" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>如何用 e-mail 傳送百科全書</title>
<link href="../../LGStyle.css" rel="stylesheet" type="text/css" />
<link href="../../../style.css" rel="stylesheet" type="text/css" />
</head>

<body>
<div id="GazetteLogo"><a href="http://www.linuxgazette.com/"><img src="../../gx/lglogo_200x41.png" alt="Linux Gazette 雜誌" width="200" height="41"  longdesc="../linuxgaette.rdf" /></a><br />
  <a href="http://www.linuxgazette.com/copying.html">Copyright</a>&copy;1996-2003<br />
  Specialized Systems Consultants, Inc.</div>
<div class="CLDPAddr">CLDP</div>
<div class="CLDPFull">Chinese Linux Documentation Project</div>
<hr />
<p class="BarTop"><a
        href="../../../index.html" title="連到首頁" hreflang="zh-TW" accesskey="H">首頁(H)</a>｜<a
        href="../../../howto" title="連到和 HOWTO  相關資訊" hreflang="zh-TW" accesskey="T">HOWTO(T)</a>｜<a
        href="../../../guide" title="連到和指南相關的資訊" hreflang="zh-TW" accesskey="G">指南(G)</a>｜<a
        href="../../../faq" title="連到和問答集相關的資訊" hreflang="zh-TW" accesskey="F">FAQ(F)</a>｜<a
        href="../../../man" title="連到和手冊頁有關的資訊" hreflang="zh-TW" accesskey="M">手冊頁(M)</a>｜<a
        href="../../index.html" title="Linux電子報為一個月發行一期的雜誌" hreflang="zh-TW" accesskey="L">Linux電子報(L)</a>｜<a
        href="../../../lf" title="LinuxFocus 為兩個月發行一期的雜誌" hreflang="zh-TW" accesskey="S">LinuxFocus(S)</a></p>
<hr />
<div class="DivCover"> 
  <div class="TitleHead">如何用 e-mail 傳送百科全書<br />
	<a href="../authors/jenkins.graham.html">Graham Jenkins</a> /曾慧涵 譯</div>
  <div> 
    <p class="BarTop"><a href="../../index.html">Linux電子報首頁</a>｜<a href="../../temp/sample/index.html">目錄</a>｜<a href="../../faq/index.html">FAQ</a><br />
      讓 Linux 更加有趣呦！</p>
  </div>
  <div> 
    <h2>目錄</h2>
  </div>
  <div> 
	<ol>
	  <li><a href="#ss1">在什麼情況下會需要 email 一份百科全書?</a></li>
	  <li><a href="#ss2">如何包裝百科全書?</a></li>
	  <li><a href="#ss3">另一種包裝百科全書的方法</a></li>
	  <li><a href="#ss4">百科全書的包裝工具</a></li>
	  <li><a href="#ss5">類似功能的軟體</a></li>
	  <li><a href="#ss6">作者介紹</a></li>
	</ol>
  </div>
  <div> 
	<h2><a name="ss1" id="ss1"></a>1. 在什麼情況下會需要 email 一份百科全書?</h2>
  </div>
  <div> 
	<p>好吧, 也許你不是要寄百科全書, 而是一部電影, 或是一個壓縮過的巨大目錄.
           不用說, 你會用 FTP 來上傳它, 除非你的電腦只連接到一個內部 LAN 的網域, 而沒法用 FTP 連接到外界. 
           或者有可能你的收件者的電腦因為安全因素無法使用 FTP.
           在這種情況下, 你可以將你要傳的東西編碼成一串 ASCII 字元, 用 e-mail 來傳送.
           你可以用 'uuencode' 軟體, 或是 <a href="http://www.ietf.org/rfc/rfc2045.txt">RFC 2045 "Multipurpose 
	  Internet Mail Extensions (MIME) Part One"</a> 中敘述的  
           Base64 Content Transfer Encoding 來進行編碼.</p>
  </div>
  <div> 
	<h2><a name="ss2" id="ss2"></a>2. 如何包裝百科全書?</h2>
  </div>
  <div> 
	<p>
          在現實世界裡, 你可以將直接將一套百科全書弄成一個包裹寄出 - 只要送件員能夠接受那份包裹的大小及重量, 這就不失為一個好方法. 
          但有時候, 你必須將百科全書拆裝成好幾份較能讓人接受的大小重量.</p>
	<p>
          同理可證, 在 email 一份百科全書時, 必須確定 e-mail 的訊息內容大小不會超出在傳送過程中經過的任何檢驗. 
          必要時, 必需將訊息拆成適當的大小, 其方法請參考
          <a href="http://www.ietf.org/rfc/rfc2046.txt">RFC 
	  2046 "Multipurpose Internet Mail Extensions (MIME) Part Two"</a>.</p>
	<p>總而言之, 我們可以順著 RFC 2045 跟 RFC 2046 的指示, 將整套百科全書做 Base64 的編碼並拆成許多部份. 
           我們要寄出的內容有一部份會看起來像這樣:</p>
	<pre class="sample">
  From grahjenk@au1.ibm.com Tue Dec 31 13:14:34 2002
  Content-Disposition: inline
  Content-Transfer-Encoding: 7bit
  Content-Type: message/partial; id="300870"; number="1"
  Subject: Graham's Encylopedia
  
  owF1Vb+P3EQUPhLRrBSFlHQjRYCQsthe/1q7CNrbREjocnvK3hHREM3ac7fWeWfM
  zPh2L38ASomEIro0SNBBg2hBSDTwR0BBEwqQaFJF8J499tob0EjW7rzv+96b772x
   ...
  szJb9DUMvKdRUIV+RY5Xu3UkRQqvJCzdzHtHoQL36Ke6elnYLgwH8MfxCU9ymq1Y
  
  --
  From grahjenk@au1.ibm.com Tue Dec 31 13:14:34 2002
  Content-Disposition: inline
  Content-Transfer-Encoding: 7bit
  Content-Type: message/partial; id="300870"; number="9"; total="9"
  Subject: Graham's Encyclopedia
  
  dc45xuruv3m3e8z/OGRD6lxz13GC5m0XbXvcWlyFW4vxbSSK5KEoTOIIuxTFs2JK
  UnZKy1wTAV9TWr2dev7WrLbXkeOHUVQnjuyXEptwm3hBgfT43auvVh/v5mt+48pb
  n+09Hf7+5Nvyx5tf/fP4o+PJ398Xf958cW3v6ejzL17/9YPfPs4unv08efvr68O/
  njz/Fw==
  
  --</pre>
  </div>
  <div> 
	<h2><a name="ss3" id="ss3"></a>3. 另一種包裝百科全書的方法</h2>
  </div>
  <div> 
	<p>對一個收件者來說, 要將上面所描述的各個部份依照正確順序組裝, 去除標題內容並將需要的部份輸入 Base64 解碼程式, 並不是一件容易的事. 
           若他使用的是舊的 Unix 機器, 他可能根本沒有 Base64 解碼器. 而若是使用 Microsoft 的機器, 他也可能無法正確的編輯訊息內容.</p>
	<p>所以, 另一種可行的方法是: 將百科全書拆成有編號的區塊, 並分別 uuencode. 
           大部份的解碼工具都聰明到懂得自動去除標題列. 即使用 Microsoft Outlook 也沒問題.</p>
	<p>為每個區塊編號的訣竅是將它們命名為淺顯易懂的序列 (例如 'cat'), 接著, 將這個序列輸入到一個 pipe 或是輸出檔(為了執行解壓縮或是 untar 功能).
           輸出的部份會看起來像這樣:</p>
	<pre class="sample">
  From grahjenk@au1.ibm.com Tue Dec 31 13:49:07 2002
  Subject: encyclo part 1/ size/sum 1024/16571
  
  begin 644 001_encyclo
  M&lt;F]O=#IX.C`Z,3I3=7!E&lt;BU5&lt;V5R.B\Z+W-B:6XO&lt;V@*9&amp;%E;6]N.G@Z,3HQ
  M.CHO.@IB:6XZ&gt;#HR.C(Z.B]U&lt;W(O8FEN.@IS&gt;7,Z&gt;#HS.C,Z.B\Z"F%D;3IX
   ...
  M8W)E&lt;',Z+V)I;B]K&lt;V@*=V-O8F%T8V@Z&gt;#HU,#(X.#HQ.D%L97@@=&amp;AE(%=A
  B;FME&lt;CHO97AP;W)T+VAO;64O=V-O8F%T8V@Z+V)I;B]K&lt;P``
  `
  end
  
  --
  From grahjenk@au1.ibm.com Tue Dec 31 13:49:07 2002
  Subject: encyclo part 2/2 size/sum 945/12218
  
  begin 644 002_encyclo
  M:`IC-S0S-#0P.G@Z-38T-C,Z-3`P-#I!;F1R97&lt;@3'5O;F&lt;Z+VAO;64O861M
  M;W!E&lt;F%T;W(Z+V5X&lt;&amp;]R="]H;VUE+V]P8U]O&lt;#HO8FEN+W-H"F,Y,34W.3DZ
  M&gt;#HU,#(Y,#HQ.CHO:&amp;]M92]A9&amp;UI;B]C.3$U-SDY.B]U&lt;W(O8FEN+V)A&lt;V@*
  `
  end
  
  --
</pre>
	<p>注意到我們現在使用的都是大寫字元, 還包括了一些括號和其他符號.
           某些符號在其他字元集中會有 mapping 上的不相容性. 
           這就是為什麼 RFC 2045 建議使用 Base64 而非 'uuencode'.</p>

</div>
  <div> 
	<h2><a name="ss4" id="ss4"></a>4. 百科全書的包裝工具</h2>
  </div>
  <div> 
	<p>在 <a href="misc/jenkins/filemail.pl.txt"> 這裡可取得包裝工具</a>. 
           為了簡易起見, 我們使用上面所述的另一種包裝方法.
           包裝工具由來已久, 大多以 C 語言寫成; 有一部份使用 Bourne-Shell 版本.
           這些工具通常使用暫存檔案.</p>
	<p>你可以使用 Perl 撰寫一個非常典雅, 且不使用任何暫存檔的包裝程式.
           這個程式既簡單又具可攜性. 我們要做的正是這樣的程式: </p>
	<pre class="sample">
#!/usr/local/bin/perl -w
# @(#) filemail.pl      Breaks incoming stream into parts, then encodes
#                       each part and e-mails it to designated recipient.
#                       Vers. 2.05; Graham Jenkins, IBM GSA, December 2002.

use strict;             # Parts are encoded and sent via a double-buffer scheme.
use File::Basename;     # Uuencoding is used to reduce module dependence.
my  $PSize = 700;       # Default (input) part-size.
my  ($Count,$Sum,$Size,$Total,$InpBuf,$InpLen,$OutBuf,$j);

if ($#ARGV eq 2) { if ($ARGV[0] =~ m/^-\d+$/ ) { $PSize=0-$ARGV[0]; shift } } 

die "Usage: cat file  |".basename($0)." [-KbPerPart] destination filename\n".
    " e.g.: tar cf - .|".basename($0)." -64 smith\@popser.acme.com mydir.tar\n".
    "(Note: default un-encoded part size = $PSize","kb)\n"  if ($#ARGV ne 1);

open(INFILE,"-") || die "Can't read input!\n";
$Count = 0; $Total = "";# Loop until no further input available.

do { $InpLen = read(INFILE, $InpBuf, 1024 * $PSize);
     $Total  = $Count if $InpLen lt 1;
     do { $Size = length($OutBuf); 
          print STDERR "$ARGV[1] part $Count/$Total =&gt; $ARGV[0] $Size bytes\n";
          $Sum  = unpack("%32C*", $OutBuf);
          foreach $j (1,2) {$Sum = ($Sum &amp; 0xffff) + int($Sum/0x10000)}
          open(PIPE, "| Mail -s" .
            "'$ARGV[1] part $Count/$Total size/sum $Size/$Sum' $ARGV[0]");
          $j = $Count ; while (length($j) &lt; 3 ) { $j = "0" . $j }
          $j = dirname($ARGV[1])."/".$j if dirname($ARGV[1]) ne "."; 
          print PIPE "begin 644 ",$j,"_", basename($ARGV[1]),"\n",
            pack("u",$OutBuf),"\`\nend\n";
          close(PIPE)                                   } if $Count gt 0;
     $Count++; $OutBuf = $InpBuf                          } until $InpLen lt 1;
</pre>
	<p>在這個程式中, Perl 的 'read' 敘述使得我們能在目標字串中取出一定數目的 byte.
           如程式所示, 我們只是不停地從標準輸入中進行讀取直到 '$InpBuf' 傳回空字串.
           每次取得一個非空白字串, 我們 uuencode '$OutBuf' 的內容(不管內容為何)並將它推入一個郵件程式中. 
           然後我們將 '$InpBuf' 的內容存入 '$OutBuf', 並進行下一次的動作./p>
	</p><p>Perl 使用 'pack' 敘述 (參數為 'u') 來進行字串的 uuencode 動作; 因此, 不需要任何額外的 modules. 
           我們使用 'unpack' 敘述的特性來計算每一個被傳送的區塊的 checksum. </p>
	<p>你應該已經觀察到: 實際上, 我們在 Unix/Linux 的 'Mail' 程式裡開啟了一個 pipe 以進行郵件傳輸. 
           若要增加可攜性, 可安裝並使用 Net::STMP module.</p>
	<p>解碼後的區塊大小的預設上限是 700kb 上限, 但我們可以另行自訂大小.</p>

</div>
  <div> 
	<h2><a name="ss5" id="ss5"></a>5. 類似功能的軟體</h2>
  </div>
  <div> 
	<p>也許某些讀者已經發現以上訊息拆解的方法和 <a href="../issue75/jenkins.html"> "Secure Printing 
	  with PGP"</a> 中所述相同. 有興趣的讀者可至 <a href="http://www.cpan.org/scripts/">"CPAN 
	  Scripts Repository"</a> 取得更新過的版本軟體. 這些軟體使用 RFC 建議的 "Base64-encode 
	  then split" 程序.</p>
	<p>較早的一篇文章 <a href="../issue68/jenkins.html"> "A Linux Client for 
	  the Brother Internet Print Protocol"</a> 中包含了一個使用 "split then send parts" 
          程序的 shell script; 它使用的編碼方式亦為 Base64.</p>









</div>
      
  <div> 
	<h2><a name="ss6" id="ss6"></a>6. 作者介紹</h2>
  </div>
  <div> 
	<p>Graham 是澳洲 IBM Global Services 的一位 Unix 專家, 現居墨爾本.
           他發展了在各種硬體平臺上工作的企業和開放系統.</p>
  </div>
  <div> 
    <h2>版權宣告</h2>
  </div>
  <div> 
	<p>Copyright © 2003, Graham Jenkins. <a href="http://www.linuxgazette.com/copying.html">Copying 
	  license</a> Published in Issue 86 of Linux Gazette, January 2003 </p>
  </div>
</div>
<hr />
<p class="BarTop"><a
        href="../../../index.html" title="連到首頁" hreflang="zh-TW" accesskey="H">首頁(H)</a>｜<a
        href="../../../howto" title="連到和 HOWTO  相關資訊" hreflang="zh-TW" accesskey="T">HOWTO(T)</a>｜<a
        href="../../../guide" title="連到和指南相關的資訊" hreflang="zh-TW" accesskey="G">指南(G)</a>｜<a
        href="../../../faq" title="連到和問答集相關的資訊" hreflang="zh-TW" accesskey="F">FAQ(F)</a>｜<a
        href="../../../man" title="連到和手冊頁有關的資訊" hreflang="zh-TW" accesskey="M">手冊頁(M)</a>｜<a
        href="../../index.html" title="Linux電子報為一個月發行一期的雜誌" hreflang="zh-TW" accesskey="L">Linux電子報(L)</a>｜<a
        href="../../../lf" title="LinuxFocus 為兩個月發行一期的雜誌" hreflang="zh-TW" accesskey="S">LinuxFocus(S)</a></p>
<hr />
</body>
</html>

