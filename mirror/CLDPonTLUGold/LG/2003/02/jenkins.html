<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html lang="zh-TW">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Linux電子報的樣本檔</title>
  <link href="../../LGStyle.css" rel="stylesheet" type="text/css">
  <link href="../../../style.css" rel="stylesheet" type="text/css">
</head>
<body>
<div id="GazetteLogo"><a href="http://www.linuxgazette.com/"><img
 src="../../gx/lglogo_200x41.png" alt="Linux Gazette 雜誌" width="200"
 height="41" longdesc="../linuxgaette.rdf"> </a><br>
<a href="http://www.linuxgazette.com/copying.html">Copyright</a>©1996-2003<br>
Specialized Systems Consultants, Inc.</div>
<div class="CLDPAddr">CLDP</div>
<div class="CLDPFull">Chinese Linux Documentation Project</div>
<hr>
<p class="BarTop"><a href="../../../index.html" title="連到首頁"
 hreflang="zh-TW" accesskey="H">首頁(H)</a>｜<a href="../../../howto/"
 title="連到和 HOWTO  相關資訊" hreflang="zh-TW" accesskey="T">HOWTO(T)</a>｜<a
 href="../../../guide/" title="連到和指南相關的資訊" hreflang="zh-TW"
 accesskey="G">指南(G)</a>｜<a href="../../../FAQ/" title="連到和問答集相關的資訊"
 hreflang="zh-TW" accesskey="F">FAQ(F)</a>｜<a href="../../../man/"
 title="連到和手冊頁有關的資訊" hreflang="zh-TW" accesskey="M">手冊頁(M)</a>｜<a
 href="../../index.html" title="Linux電子報為一個月發行一期的雜誌" hreflang="zh-TW"
 accesskey="L">Linux電子報(L)</a>｜<a href="../../../LF/"
 title="LinuxFocus 為兩個月發行一期的雜誌" hreflang="zh-TW" accesskey="S">LinuxFocus(S)</a></p>
<hr>
<div class="DivCover">
<div class="TitleHead"> A Keep-Alive Program You Can Run Anywhere <br>
By <a href="file:///Data/CLDP/LG/2003/02/authors/jenkins.graham.html">Graham
Jenkins</a> </div>
<div>
<p class="BarTop"><a href="../../index.html">Linux電子報首頁</a>｜<a
 href="index.html">目錄</a>｜<a href="../../faq/index.html">FAQ</a><br>
讓 Linux 更加有趣呦！</p>
</div>
<div>
<h2>目錄</h2>
</div>
<div>
<ol>
  <li>The Poodle and the Labrador</li>
  <li>The Blonde Solution</li>
  <li>For The Terminally-Challenged</li>
  <li>Finding A Partner</li>
  <li>Getting It Together</li>
  <li>If You Don't Have It<br>
  </li>
</ol>
</div>
<div>
<h2>1. The Poodle and the Labrador</h2>
</div>
<div>
<p>You are halfway through typing a new program into a remote machine
connected over a dial-up line, and you get called to intervene in a
fight between your partner's miniature poodle and the neighbour's ugly
yellow Labrador. When you get back, your connection has timed-out.</p>
<p>Is this something that has happened to you? Or perhaps you had to
drag your kids away from a particularly offensive episode of Jerry
Springer, then found you had to stick around to make sure they didn't
come back?</p>
</div>
<div>
<h2>2. The Blonde Solution</h2>
</div>
<div>
<p>The traditional procedure for maintaining activity on your line
during an interruption of the type outlined above was to use a 'fortune'
program in a small loop so that a random saying got written to your
screen every half-minute. This could present some real problems if a
person with fair hair looked at your screen and saw something like:</p>
<pre> Q:  How do you make a blonde's eyes light up?<br> A:  Shine a flashlight in her ear.<br></pre>
<p>You could of course used a '-i' or equivalent parameter restricting
'fortune' to generating inoffensive material like:</p>
<pre>  Computing Definition<br>  Chaining - A method of attaching programmers to desk, to speed up output.<br></pre>
<p>The more recent incarnations of the 'fortune' program offer their
users a more specific set of options. You can chose between offending
those who are Irish, gay or intellectually retarded!</p>
</div>
<div>
<h2>3. For The Terminally-Challenged</h2>
</div>
<div>
<p>If you are just using a browser to read your Hotmail messages, you
probably won't want to open a terminal window just so you can run a
'fortune' program. If you are using an X11-compliant window-manager, you
could start a clock program with something like:</p>
<pre> xclock -digital -update 1 &amp;</pre>
<p>But that's not going to work on your your vintage Windows 95 machine
unless you also happen to be running something like PC-Xware.</p>
<p>The 'KeepAlive.java' program listed here is designed to work
anywhere. It's written in Java 1.1 so that even the 'jview' virtual
machine on your basic Microsoft machine can handle it. It doesn't rely
on finding a 'fortune', 'xclock' or other program on a remote machine.
And you don't have to change anything when you connect via a different
ISP.</p>
</div>
<div>
<h2>4. Finding A Partner</h2>
</div>
<div>
<p>But you have to send traffic somewhere, right? So how do you find a
partner machine which will receive your traffic? If we were writing this
program as a shell script, we might work out where our gateway was, and
ping it at appropriate intervals. That's not so easy to do in a Java
program which might run on any number of platforms. And in any case, it
would be nice if we could send traffic somewhere beyond the gateway
machine.</p>
<p>In almost every sort of networking arrangement, the participating
machines have knowledge of one or more nameserver addresses. So what we
can do from our Java program is make periodic requests to those
nameservers. We need to ensure that any hosts whose addresses we request
cannot be found locally in a hosts table. And we need to also ensure
that the answers to our nameserver requests are not cached locally. If
you take a look now at the program, you will see that the names of the
hosts whose addresses we are requesting are generated by examining the
clock-time in milliseconds at the time of each request. This results in
names like A1040689223909, A1040689229448, etc.</p>
<p>That's really all we need to do. But it's nice to be able to see
something happening. So our program defines a 'MessageFrame' class which
displays two colored buttons in a GUI window. The colors of these are
changed at each iteration. We also set the title on the GUI window, and
change it at each iteration - so we can still see something happening
when the window is minimized. And we set up a listener to detect
'window closing' events and perform a graceful shutdown.</p>
</div>
<div>
<h2>5. Getting It Together</h2>
</div>
<div>
<p>Here's the <a
 href="file:///Data/CLDP/LG/2003/02/temp/misc/jenkins/KeepAlive.java.txt">program</a>.
You need to compile it with a command like: </p>
<pre> javac KeepAlive.java</pre>
This will generate three 'class' files which contain code which can be
executed on a java virtual machine. So you can copy those class files to
a directory on another machine, then execute it with a command like:
<pre> java KeepAlive</pre>
To use the Microsoft virtual machine on a Windows box, use:
<pre> java KeepAlive</pre>
<pre>/* @(#) KeepAlive.java  Trivial keep-alive program. Tries at 5-second intervals<br> *                      to find addresses for hosts with generated names. This<br> *                      ensures that messages are sent to nameserver(s).<br> *                      Copyright (c) 2002 Graham Jenkins &lt;grahjenk@au1.ibm.com&gt;<br> *                      All rights reserved. Version 1.06, August 15, 2002.<br> */<br>import java.io.*;<br>import java.net.*;<br>import java.awt.*;<br>import java.awt.event.*;<br>import java.util.Date;<br>public class KeepAlive {<br>  public static void main(String[] args) {<br>    MessageFrame f=new MessageFrame();  // Change button colours each iteration.<br>    int flag=0;                         // Also switch frame-title so we can see<br>    while ( true ) {                    // activity whilst iconified.<br>      f.statusMess(Color.red,Color.red); f.setTitle("==X==");<br>      try {InetAddress addr=InetAddress.getByName("A"+(new Date()).getTime());}<br>      catch (UnknownHostException ioe) {}<br>      if(flag==0) {f.statusMess(Color.yellow,Color.green); f.setTitle("1.06");}<br>      else {f.statusMess(Color.green,Color.yellow); f.setTitle("KeepAlive");}<br>      flag=1-flag;<br>      try {Thread.sleep(5000L);} catch (InterruptedException e) {}<br>    }<br>  }<br>}<br><br>class MessageFrame extends Frame implements ActionListener {<br>  private Button b1, b2;                // Displays two coloured buttons.<br>  public MessageFrame() {<br>    Panel p=new Panel(); p.setLayout(new FlowLayout());<br>    b1=new Button() ; b2=new Button(); p.add(b1); p.add(b2);<br>    this.add("South",p); this.setSize(150,50); this.show();<br>    this.addWindowListener(new WindowAdapter() {<br>      public void windowClosing(WindowEvent e) { System.exit(0); }<br>    });<br>  }<br>  public void statusMess(Color left, Color right) {<br>    b1.setBackground(left); b2.setBackground(right);<br>  }<br>  public void actionPerformed(ActionEvent e) {}<br>}<br></pre>
<p>If you have Java 1.1 or later, and no requirement to use the
Microsoft virtual machine, you can assemble the class files into a
single 'jar' file, then execute it using the '-jar' option thus: </p>
<pre>  echo "Main-Class: KeepAlive\015" &gt;/tmp/MyManifest<br>  jar cmf /tmp/MyManifest /tmp/KeepAlive.jar *.class<br>  <br>  java -jar /tmp/KeepAlive.jar<br></pre>
</div>
<div>
<h2>6. If You Don't Have It</h2>
</div>
<div>
<p>If your machine doesn't have Java, you can get it from <a
 href="http://java.sun.com/j2se/downloads.html">Sun MicroSystems</a>.
And if you need to know more about network programming with Java, you
could take a look at <a href="http://www.davidreilly.com/jnpbook">"Java
Network Programming and Distributed Computing" by David Reilly and
Michael Reilly</a>.</p>
</div>
<div>
<h2>作者介紹</h2>
</div>
<div>
<p> Graham is a Unix Specialist at IBM Global Services, Australia. He
lives in Melbourne and has built and managed many flavors of proprietary
and open systems on several hardware platforms. </p>
</div>
<div>
<h2>版權宣告</h2>
</div>
<div>
<p> Copyright © 2003, Graham Jenkins. Copying license <a
 href="file:///Data/CLDP/LG/2003/02/copying.html">http://www.linuxgazette.com/copying.html</a><br>
Published in Issue 87 of <i>Linux Gazette</i>, February 2003</p>
</div>
</div>
<hr>
<p class="BarTop"><a href="../../../index.html" title="連到首頁"
 hreflang="zh-TW" accesskey="H">首頁(H)</a>｜<a href="../../../howto/"
 title="連到和 HOWTO  相關資訊" hreflang="zh-TW" accesskey="T">HOWTO(T)</a>｜<a
 href="../../../guide/" title="連到和指南相關的資訊" hreflang="zh-TW"
 accesskey="G">指南(G)</a>｜<a href="../../../FAQ/" title="連到和問答集相關的資訊"
 hreflang="zh-TW" accesskey="F">FAQ(F)</a>｜<a href="../../../man/"
 title="連到和手冊頁有關的資訊" hreflang="zh-TW" accesskey="M">手冊頁(M)</a>｜<a
 href="../../index.html" title="Linux電子報為一個月發行一期的雜誌" hreflang="zh-TW"
 accesskey="L">Linux電子報(L)</a>｜<a href="../../../LF/"
 title="LinuxFocus 為兩個月發行一期的雜誌" hreflang="zh-TW" accesskey="S">LinuxFocus(S)</a></p>
<hr>
</body>
</html>
