<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Linux Laptop-HOWTO: Installation</TITLE>
 <LINK HREF="Laptop-HOWTO-6.html" REL=next>
 <LINK HREF="Laptop-HOWTO-4.html" REL=previous>
 <LINK HREF="Laptop-HOWTO.html#toc5" REL=contents>
<SCRIPT src="../menu.js"> function BeginPage() {} function EndPage() {} </SCRIPT> </HEAD> <BODY bgcolor=#EEEEFF MARGINHEIGHT=0 MARGINWIDTH=0> <SCRIPT>BeginPage(1, 8, 1);</SCRIPT>
<A HREF="Laptop-HOWTO-6.html"><IMG SRC="../img/next.gif" ALT="Next"></A>
<A HREF="Laptop-HOWTO-4.html"><IMG SRC="../img/prev.gif" ALT="Previous"></A>
<A HREF="Laptop-HOWTO.html#toc5"><IMG SRC="../img/toc.gif" ALT="Contents"></A>
<HR>
<H2><A NAME="s5">5. Installation</A></H2>

<P>
<H2><A NAME="ss5.1">5.1 Related HOWTOs</A>
</H2>

<P>
<OL>
<LI>CDROM-HOWTO</LI>
<LI>Config-HOWTO</LI>
<LI>Diskless-mini-HOWTO</LI>
<LI>Installation-HOWTO</LI>
<LI>Pre-Installation-Checklist-mini-HOWTO</LI>
<LI>Update-mini-HOWTO</LI>
<LI>Hard-Disk-Upgrade-mini-HOWTO</LI>
<LI>Installation and getting started by Matt Welsh and others available at the LINUX DOCUMENTATION PROJECT 
<A HREF="http://metalab.unc.edu/LDP">http://metalab.unc.edu/LDP</A></LI>
<LI>Installing Debian Linux 2.1 For x86 by Bruce Perens, Sven Rudolph, Igor Grobman, James Treacy, Adam P. Harris 
<A HREF="ftp://ftp.debian.org/debian/dists/slink/main/disks-i386/current/install.html">ftp://ftp.debian.org/debian/dists/slink/main/disks-i386/current/install.html</A>
</LI>
<LI>Install-From-Zip-mini-HOWTO</LI>
<LI>
<A HREF="http://www.torque.net/~campbell">ZIP-Drive-mini-HOWTO </A> </LI>
</OL>
<P>
<H2><A NAME="ss5.2">5.2 Prerequisites - Partitioning</A>
</H2>

<P>Partitioning can be done in a very sophisticated way. Currently I have only some first thoughts. I assume that with laptops there are still some reasons (e.g. updating the firmware of PCMCIA cards and BIOS) to share Linux and Windows9x/NT. Depending on your needs and the features of your laptop you could create the following partitions:
<P>
<UL>
<LI>BIOS, some current BIOSes use a separate partition</LI>
<LI>suspend to disk, some laptops support this feature</LI>
<LI>swap space Linux</LI>
<LI>swap space Windows9x/NT</LI>
<LI>Linux base</LI>
<LI>Linux /home or data</LI>
<LI>common data between Linux and Windows9x/NT</LI>
</UL>
<P>Note this chapter isn't ready yet. Please read the according HOWTOs first.
<P>
<H2><A NAME="ss5.3">5.3 Linux Tools to Repartition a Hard Disk</A>
</H2>

<P>
<H3>GNU parted</H3>

<P>
<A HREF="http://www.alphalink.com.au/~clausen/parted/">GNU parted</A> allows you to create, destroy, resize and copy partitions. It currently supports ext2 and fat (fat16 and fat32) filesystems, and MS-DOS disklabels. This program can destroy data, and is not yet safe for general use. <CODE>parted</CODE> is currently in its early developement stage.
<P>
<H3>ext2resize</H3>

<P>
<A HREF="http://www.dsv.nl/~buytenh/ext2resize/">ext2resize</A> is a program capable of resizing (shrinking and growing) ext2 filesystems. Checks whether the new size the user gave is feasible (i.e. whether the fs isn't too occupied to shrink it), connected to the <CODE>parted</CODE> project.
<P>
<H3>fixdisktable</H3>

<P>Something was recently published on the &lt;linux-kernel@vger.kernel.org&gt; mailing list about a partition recovery program. I have not used this, nor examined it, nor read much about it (except for the HTML page.) It may be useful to some of you if you have problems with FIPS, Ranish Partition Manager/Utility or Partition Magic destroying your partition information. You can find information on this partition-fixer named &quot;fixdisktable&quot; at 
<A HREF="http://bmrc.berkeley.edu/people/chaffee/fat32.html">http://bmrc.berkeley.edu/people/chaffee/fat32.html </A>. It is quite a ways down in that page. Or look for it via ftp in 
<A HREF="ftp://bmrc.berkeley.edu/pub/linux/rescue/"> ftp://bmrc.berkeley.edu/pub/linux/rescue/</A> and locate the latest &quot;fixdisktable&quot; in that ftp directory. (Source and binary dist should be available.)
<P>
<H3>Caveats</H3>

<P>Before repartitioning your harddisk take care about the disk layout. Especially look for hidden disk space or certain partitions used for <I>suspend to disk</I> or <I>hibernation</I> mode. Some laptops come with a partition which contains some BIOS programs (e.g. COMPAQ Armada 1592DT). Search the manual carefully for tools like <CODE>PHDISK.EXE</CODE>, Suspend to Disk, Diagnostic TOOLS.
<P>Please see chapter 
<A HREF="Laptop-HOWTO-14.html#dostools">DOS Tools to Repartition a Hard Disk</A>, too.
<P>By Nathan Myers from 
<A HREF="http://www.linuxlaptops.com">LL - LinuxLaptops</A>: &quot;I partitioned a 10G Thinkpad drive last week and then none of fdisk, cfdisk, or sfdisk would read the partition table any more. It turns out I had created a partition that started on cylinder 1024, and there's a bug common to all three programs that makes them fail in that case. (I didn't try Disk Druid.) So, maybe you should add some advice about not starting partitions on that cylinder.&quot;
<P>
<H3>Multi Boot</H3>

<P>Please see the Different Environments chapter, for information about booting different operating systems from the same harddisk.
<P>
<H2><A NAME="ss5.4">5.4 Installation Methods</A>
</H2>

<P>From the Battery-HOWTO:&quot;Installing and using Linux on a laptop is usually no problem at all, so go ahead and give it a try. Unlike some other operating systems, Linux still supports and runs well on even very old hardware, so you might give your outdated portable a new purpose in life by installing Linux on it.&quot; 
<P>One of the great benefits of Linux are its numerous and flexible installation features, which I don't want to describe in detail. Instead I try to focus on <I>laptop specific methods</I>, which are necessary only in certain circumstances.
<P>Most current distributions support installation methods which are useful for laptops, including installation from CD-ROM, via PCMCIA and NFS (or maybe SMB). Please see the documents which are provided with these distributions for further details or take a look at the above mentioned manuals and HOWTOs.
<P>
<H2><A NAME="ss5.5">5.5 From a Boot Floppy plus CD-ROM - The Usual Way</A>
</H2>

<P>With modern laptops, the usual Linux installation (one Boot Floppy, one Support Floppy, one Packages CD-ROM) should be no problem, if there is are floppy drive and a CD-ROM drive available. Though with certain laptops you might get trouble if you can not simultaneously use the <I>floppy drive and CD-ROM drive </I>, or if the floppy drive is <I>only available as a PCMCIA device</I>, as with the Toshiba Libretto 100. Some laptops support also booting and therefore installation completely from a CD drive, as reported for the SONY VAIO in the VAIO-HOWTO. Note: Check the BIOS for the CD boot option and make sure your Linux distribution comes on a bootable CD.
<P>Certain laptops will only boot <I>zImage</I> kernels. <I>bzImage</I> kernels won't work. This is a known problem with the IBM Thinkpad 600 and Toshiba Tecra series, for instance. Some distributions provide certain boot floppies for these machines or for machines with limited memory resources, Debian/GNU Linux 
<A HREF="http://www.debian.org">http://www.debian.org</A> for instance.
<P>
<H2><A NAME="ss5.6">5.6 From a DOS or Windows Partition at the Same Machine</A>
</H2>

<P>This is a short description of how to install from a CD-ROM under DOS without using boot or supplemental floppy diskettes. This is especially useful for notebooks with <I>swappable floppy and CD-ROM components</I> (if both are mutually exclusive) or if they are <I>only available as PCMCIA devices</I>. I have taken this method from &quot;Installing Debian GNU/Linux 2.1 For Intel x86 - Chapter 5 Methods for Installing Debian&quot; 
<A HREF="http://www.debian.org">http://www.debian.org</A> :
<P>
<OL>
<LI>Get the following files from your nearest Debian FTP mirror and put them into a directory on your DOS partition: <CODE>resc1440.bin drv1440.bin base2_1.tgz root.bin linux install.bat</CODE> and <CODE>loadlin.exe</CODE>. 
</LI>
<LI>Boot into DOS (not Windows) without any drivers being loaded. To do this, you have to press &lt;<CODE>F8</CODE>&gt; at exactly the right moment.
</LI>
<LI>Execute <CODE>install.bat</CODE> from that directory in DOS. 
</LI>
<LI>Reboot the system and install the rest of the distribution, you may now use all the advanced features such as PCMCIA, PPP and others. 
</LI>
</OL>
<P>This should work for other distributions with similar changes. For RedHat see 
<A HREF="http://www.cs.utexas.edu/users/kharker/linux-laptop/install_advice.html">How to Install from CD-ROM without Boot and Supplemental Disks</A> .
<P>Some new laptops may be able to boot a Linux distribution on a bootable CD-ROM (e.g., RedHat). This would allow installation without a floppy disk drive.
<P>
<H2><A NAME="ss5.7">5.7 From a Second Machine With a Micro Linux On a Floppy</A>
</H2>

<P>
<H3>Introduction</H3>

<P>Because of their small or non-existent footprint, micro-Linuxes are especially suited to run on laptops, particularly if you use a company-provided laptop running Windows9x/NT. Or for installation purposes using another non Linux machine. There are several <I>micro</I> Linux distributions out there that boot from one or two floppies and run off a ramdisk. See appendix A for a listing of distributions.
<P>I tried the following with <CODE>muLinux</CODE> 
<A HREF="http://mulinux.firenze.linux.it/">http://mulinux.firenze.linux.it/</A> to clone my HP OmniBook 800 to a COMPAQ Armada 1592DT. Thanks to Michele Andreoli, maintainer of muLinux for his support. Since <CODE>muLinux</CODE> doesn't support PCMCIA yet, you may use <CODE>TomsRtBt</CODE> instead. In turn <CODE>TomsRtBt</CODE> doesn't support <CODE>PPP</CODE> but provides <CODE>slip</CODE>. Note: Since version 7.0 <CODE>muLinux</CODE> provides an Add-On with PCMCIA support.
<P>I have described how to copy an already existing partition, but it might be also possible to achieve a customized installation. Note: Usually you would try to achieve an installation via NFS, which is supported by many distributions. Or if your sources are not at a Linux machine you might try the SMB protocol with SAMBA, which is also supported by <CODE>muLinux</CODE> .
<P>
<H3>Prerequisites</H3>

<P>You need two machines equipped with Linux. With the laptop (client/destination) on which you want to install Linux use the muLinux floppy. The other machine (server/source) may be a usual Linux box or also using muLinux. Though its low transfer rate I use a serial null modem cable because its cheap. You may apply the according method using a PCMCIA network card and a crossover network cable or a HUB, or a parallel &quot;null modem&quot; cable and PLIP. As the basic protocol I used PPP, but you may also use SLIP. For the data-transfer I used <CODE>nc</CODE>. Note: this is an abbrevation for <CODE>netcat</CODE>, some distributions use this as the program name. You may use <CODE>ftp</CODE>, <CODE>tftp</CODE>, <CODE>rsh</CODE>, <CODE>ssh</CODE>, <CODE>dd</CODE>, <CODE>rcp</CODE>, <CODE>kermit</CODE>, <CODE>NFS</CODE>, <CODE>SMB</CODE> and other programs instead.
<P>Basic requirements are:
<P>
<OL>
<LI>A good knowledge about using Linux. You have to know exactly what you are doing, if not you might end destroying former installations.</LI>
<LI>A nullmodem serial cable.</LI>
</OL>
<P>
<H3>Source Machine</H3>

<P>At your <I>source</I> machine issue the following commands (attention: IP address, port number, partition and tty are just examples!):
<P>
<OL>
<LI>Edit /etc/ppp/options, it should contain only:
<HR>
<PRE>
/dev/ttyS0
115200
passive
</PRE>
<HR>
</LI>
<LI>With muLinux versions 3.x you may even use the convenient command <CODE>setup -f ppp</CODE> .</LI>
<LI>Start PPP: <CODE>pppd</CODE> .</LI>
<LI>Configure the PPP network device: <CODE>ifconfig ppp0 192.168.0.1</CODE> .</LI>
<LI>Add the default route: <CODE>route add default gw 192.168.0.1</CODE> .</LI>
<LI>Check the network connection: <CODE>ping 192.168.0.2</CODE>, though the destination machine isn't up yet.</LI>
<LI>Start the transfer from another console, remember <CODE>&lt;LEFT-ALT&gt;&lt;Fx&gt;</CODE>: <CODE>cat /dev/hda2 | gzip -c | nc -l -p 5555</CODE> .</LI>
<LI>After the transfer (there are no more harddisk writings) stop the ping: <CODE>killall ping</CODE> .</LI>
</OL>
<P>
<H3>Destination Machine</H3>

<P>At the <I>destination</I> machine issue:
<P>
<OL>
<LI>Edit /etc/ppp/options, it should contain only:
<HR>
<PRE>
/dev/ttyS0
115200
passive
</PRE>
<HR>
</LI>
<LI>With muLinux versions &gt;= 3.x you may even use the convenient command <CODE>setup -f ppp</CODE> .</LI>
<LI>Start PPP: <CODE>pppd</CODE> .</LI>
<LI>Configure the PPP network device: <CODE>ifconfig ppp0 192.168.0.2</CODE> .</LI>
<LI>Add the default route: <CODE>route add default gw 192.168.0.2</CODE> .</LI>
<LI>Check the network connection, by pinging to the source machine: <CODE>ping 192.168.0.1</CODE> .</LI>
<LI>Change to another console and get the data from the server: <CODE>nc 192.168.0.1 5555 | gzip -dc &gt;/dev/hda4</CODE> .</LI>
<LI>400 MB may take app. 6 hours, but YMMV.</LI>
<LI>Stop the transfer, when it is finished with: <CODE>&lt;CTL&gt;&lt;C&gt;</CODE> . This can probably be avoided (but I didn't test it) by adding a timeout of 3 seconds using the <CODE>-w 3</CODE> parameter for <CODE>nc</CODE> at the destination machine <CODE>nc -w 3 192.168.0.1 5555 | gzip -dc &gt;/dev/hda4</CODE></LI>
<LI>After the transfer is completed, stop the ping: <CODE>killall ping</CODE> .</LI>
</OL>
<P>
<H3>Configuration of the Destination Machine after the Transfer</H3>

<P>
<P>
<OL>
<LI>Edit /etc/fstab .</LI>
<LI>Edit /etc/lilo.conf and /etc/lilo.msg and start <CODE>lilo</CODE> .</LI>
<LI>Set the new root device to the kernel: <CODE>rdev image root_device</CODE> .</LI>
</OL>
<P>
<H3>Miscellaneous</H3>

<P>
<P>
<OL>
<LI>You may use <CODE>bzip2</CODE> the same way as <CODE>gzip</CODE> (untested).
</LI>
<LI>Since <CODE>rshd</CODE>, <CODE>sshd</CODE>, <CODE>ftpd</CODE> daemons are not available with muLinux you have to build your own daemon with <CODE>nc</CODE> aka <CODE>netcat</CODE>, as described above.</LI>
<LI>I had to set up both PPP sides very quick or the connection broke, I don't know why.</LI>
<LI>Speed optimization has to be done, <CODE>asyncmap 0</CODE> or <CODE>local</CODE>?</LI>
<LI>I checked this only with a destination partition greater than the source partition. Please check <CODE>dd</CODE> instead of <CODE>cat</CODE> therefore.
<P>Or do the following (untested): At the destination machine <CODE>cd</CODE> into the root directory / and do <CODE>nc -l -p 5555 | bzip2 -dc | tar xvf -</CODE>. At the source machine machine <CODE>cd</CODE> into the root directory / and do <CODE>tar cvf - . | bzip2 | nc -w 3 192.168.0.2 5555</CODE>. This should shorten the time needed for the operation, too. Because only the allocated blocks need to be transfered.
<P>
</LI>
<LI>Don't <CODE>mount</CODE> the destination partition.</LI>
</OL>
<P>
<H2><A NAME="ss5.8">5.8 From a Second Machine With a 2.5&quot; Hard Disk Adapter</A>
</H2>

<P>From Adam Sulmicki adam@cfar.unc.edu I got this hint: Most but not all harddisks in laptops are removable, but this might be not an easy task. You could just buy one of those cheap 2.5&quot; IDE converters/adapters which allow you to connect this harddisk temporarily to a PC with IDE subsystem, and install Linux as usual using that PC. You may do so using the harddisk as the first IDE drive or besides as the second IDE drive. But than you need to be sure that lilo writes to the right partition. Also you have to make sure that you use the same translation style as your laptop is going to use (i.e. LBA vs. LARGE vs. CHS ). You find additional information in the Hard-Disk-Upgrade-mini-HOWTO. You might copy an existing partition, but it is also possible to achieve a customized installation.
<P>
<H2><A NAME="ss5.9">5.9 From a PCMCIA Device</A>
</H2>

<P>Since I don't have a laptop which comes with a PCMCIA <I>floppy drive</I> (for instance Toshiba Libretto 100), I couldn't check this method. Please see the chapter Booting from a PCMCIA Device in the PCMCIA-HOWTO. Also I couldn't check whether booting from a PCMCIA <I>harddisk</I> is possible.
<P>Anyway, when you are able to boot from a floppy and the laptop provides a PCMCIA slot, it should be possible to use different PCMCIA cards to connect to another machine, to an external SCSI device, different external CD and ZIP drives and others. Usually these methods are described in the documentation which is provided with the distribution.
<P>
<H2><A NAME="ss5.10">5.10 From a Parallel Port Device (ZIP Drive, CD Drive)</A>
</H2>

<P>I couldn't check this method by myself, because I don't have such a device. Please check the according Install-From-Zip-mini-HOWTO and CD-HOWTO. Also I don't know how much these installation methods are supported by the Linux distributions or the micro Linuxes. I suppose you have to fiddle around a bit to get this working.
<P>
<H2><A NAME="ss5.11">5.11 From a Second Machine Using the Parallel Port - PLIP Network Install</A>
</H2>

<P>I got this courtesy by Nathan Myers &lt;ncm@cantrip.org&gt;: &quot;Many distributions support installing via a network, using FTP, HTTP, or NFS. It is increasingly common for laptops to have only a single PCMCIA slot, already occupied by the boot floppy drive. Usually the boot floppy image has drivers for neither the floppy drive itself, nor the PCMCIA subsystem. Thus, the only network interface available may be the parallel port.
<P>Installation via the parallel port using the PLIP protocol has been demonstrated on, at least, Red Hat. All you need is a <I>Laplink</I> parallel cable, cheap at any computer store. See the PLIP-mini-HOWTO for details on setting up the connection. Note that (uniquely) the RedHat installation requires that the other end of the PLIP connection be configured to use ARP (apparently because RedHat uses the DOS driver in their installer). On the host, either <CODE>export</CODE> your CD file system on NFS, or <CODE>mount</CODE> it where the ftp or web daemon can find it, as needed for the installation.&quot; 
<P>The PLIP Install HOWTO by Gilles Lamiral describes how to install the Debian GNU-Linux distribution on a computer without ethernet card, nor cdrom, but just a local floppy drive and a remote nfs server attached by a Null-Modem parallel cable. The nfs server has a cdrom drive mounted and exported.
<P>
<H2><A NAME="ss5.12">5.12 Installing Linux on Small Machines</A>
</H2>

<P>If you have less than 8MB memory and want to install via NFS you may get the message &quot;fork: out of memory&quot;. To handle this problem, use <CODE>fdisk</CODE> to make a swap partition (<CODE>fdisk</CODE> should be on the install floppy or take one of the mini Linuxes described above). Then try to boot from the install floppy again. Before configuring the NFS connection change to another console (for instance by pressing &lt;ALT&gt;&lt;2&gt;) and issue <CODE>swapon /dev/xxx</CODE>   (xxx = swap partition ). Thanks to Thomas Schmaltz.
<P>
<HR>
<A HREF="Laptop-HOWTO-6.html"><IMG SRC="../img/next.gif" ALT="Next"></A>
<A HREF="Laptop-HOWTO-4.html"><IMG SRC="../img/prev.gif" ALT="Previous"></A>
<A HREF="Laptop-HOWTO.html#toc5"><IMG SRC="../img/toc.gif" ALT="Contents"></A>
<SCRIPT>EndPage();</SCRIPT>  </BODY>
</HTML>
