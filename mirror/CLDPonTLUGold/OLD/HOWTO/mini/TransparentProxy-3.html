<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Transparent Proxy with Squid mini-HOWTO: Configuring the Kernel</TITLE>
 <LINK HREF="TransparentProxy-4.html" REL=next>
 <LINK HREF="TransparentProxy-2.html" REL=previous>
 <LINK HREF="TransparentProxy.html#toc3" REL=contents>
<SCRIPT src="../../menu.js"> function BeginPage() {} function EndPage() {} </SCRIPT> </HEAD> <BODY bgcolor=#EEEEFF MARGINHEIGHT=0 MARGINWIDTH=0> <SCRIPT>BeginPage(2, 8, 2);</SCRIPT>
<A HREF="TransparentProxy-4.html"><IMG SRC="../../img/next.gif" ALT="Next"></A>
<A HREF="TransparentProxy-2.html"><IMG SRC="../../img/prev.gif" ALT="Previous"></A>
<A HREF="TransparentProxy.html#toc3"><IMG SRC="../../img/toc.gif" ALT="Contents"></A>
<HR>
<H2><A NAME="s3">3. Configuring the Kernel</A></H2>

<P>First, we need to make sure all the proper options are set in your kernel.
If you are using a stock kernel from your distribution, transparent proxying
may or may not be enabled.
If you are unsure, the best way to tell is to simply skip this section, and
if the commands in the next section give you weird errors, it's probably because
the kernel wasn't configured properly.
<P>If your kernel is not configured for transparent proxying, you will need
to recompile. Recompiling a kernel is a complex process (at least at first),
and it is beyond the scope of this document. If you need help compiling a kernel,
please see 
<A HREF="http://metalab.unc.edu/pub/Linux/docs/HOWTO/Kernel-HOWTO">The Kernel HOWTO</A><P>The options you need to set in your configuration are as follows (Note:
none of these can be built as modules)
<P>
<UL>
<LI>Networking support</LI>
<LI>Sysctl support</LI>
<LI>Network packet filtering</LI>
<LI>TCP/IP networking</LI>
<LI>Connection tracking (Under ``IP: Netfilter Configuration'' in menuconfig)</LI>
<LI>IP tables support </LI>
<LI>Full NAT</LI>
<LI>REDIRECT target support</LI>
<LI>/proc filesystem support</LI>
</UL>

You must say NO to ``Fast switching''
<P>Once you have your new kernel up and running, you may need to enable IP
forwarding. IP forwarding allows your computer to act as a router. Since this
is not what the average user wants to do, it is off by default and must be
explicitly enabled at run-time. However, your distribution might do this for
you already. To check, do ``cat /proc/sys/net/ipv4/ip_forward''. If you see
``1'' you're good. Otherwise, do ``echo '1' &gt; /proc/sys/net/ipv4/ip_forward''.
You will then want to add that command to your appropriate bootup scripts (depending on your distribution, these may live in /etc/rc.d, /etc/init.d, or maybe somewhere else entirely).
<HR>
<A HREF="TransparentProxy-4.html"><IMG SRC="../../img/next.gif" ALT="Next"></A>
<A HREF="TransparentProxy-2.html"><IMG SRC="../../img/prev.gif" ALT="Previous"></A>
<A HREF="TransparentProxy.html#toc3"><IMG SRC="../../img/toc.gif" ALT="Contents"></A>
<SCRIPT>EndPage();</SCRIPT>  </BODY>
</HTML>
