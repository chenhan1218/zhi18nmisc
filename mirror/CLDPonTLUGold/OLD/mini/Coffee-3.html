<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=big5">
 <META NAME="GENERATOR" CONTENT="ZH-SGML-Tools 1.0.9">
 <TITLE>COFFEE-HOWTO --如何用 Linux 來煮咖啡: 軟件</TITLE>
 <LINK HREF="Coffee-4.html" REL=next>
 <LINK HREF="Coffee-2.html" REL=previous>
 <LINK HREF="Coffee.html#toc3" REL=contents>
<SCRIPT src="../menu.js"> function BeginPage() {} function EndPage() {} </SCRIPT> </HEAD> <BODY bgcolor=#EEEEFF MARGINHEIGHT=0 MARGINWIDTH=0> <SCRIPT>BeginPage(1, 2, 6);</SCRIPT>
<A HREF="Coffee-4.html"><IMG SRC="../img/next.gif" ALT="Next"></A>
<A HREF="Coffee-2.html"><IMG SRC="../img/prev.gif" ALT="Previous"></A>
<A HREF="Coffee.html#toc3"><IMG SRC="../img/toc.gif" ALT="Contents"></A>
<HR>
<H2><A NAME="s3">3. 軟件</A></H2>

<P>
<P>
<H2><A NAME="ss3.1">3.1 軟件</A>
</H2>

<P>你必須得到一個有以下功能的可執行程序：
<UL>
<LI>通過<B> ioperm </B>命令，例如，<EM>ioperm ( BASE, range , 1)，</EM>調用內核，得到 I/O 地址空間的使用權;</LI>
<LI>通過一個發送請求指令，例如，<EM> outb(1, BASE ) </EM>，設定并口電壓為 0-5V﹔</LI>
<LI>等待足夠的時間讓咖啡煮好，讓時間參數在命令行中被讀取是一件很好的事情﹔</LI>
<LI>然后發送 out(0, BASE) 指令關掉咖啡機﹔</LI>
<LI>在結束之前還應歸還并口 I/O 地址的使用權，<EM> ioperm(BASE,range,0)﹔</EM></LI>
</UL>

改變 /dev/lp0 的基地址為 0x3bc ，/dev/lp1 為 0x378 ，/dev/lp2 為 0x278，范圍( range ) 為 8 。
<P>
<P>如果在這個程序中再使用 setuid 會更好，因為每個用戶都可以用 Linux 煮咖啡了！
<P>
<H2><A NAME="ss3.2">3.2 設備驅動程序</A>
</H2>

<P>
<P>參考 
<A HREF="http://www.redhat.com:8080/HyperNews/get/khg.html">kernel hacker's guide</A>, 
安裝一個設備驅動程序 (it could even be user space i think). 
請以模塊(module)方式編譯，這樣以后每次更新的時候也用不著重新編譯內核了。
然后打入:
<P>
<PRE>
echo cappuccino >/dev/coffee
</PRE>
<P>1 分鐘后你就會有一杯熱咖啡，注意 /dev/coffee 要設置合適的權限，具體看你是否只想讓超級用戶煮咖啡了。
<P>
<P>這種方法有個優點就是它能用并口的 ACK 針腳來實現從咖啡機的反饋支持。所以一個智能的咖啡機有時還會中斷一下。
<P>
<P>把它當作課外作業
<P>
<H2><A NAME="ss3.3">3.3 通過 Internet 連接</A>
</H2>

<P>如果你已經有了這個 C 程序（如上），你只需寫一個 CGI 腳本就可以開關咖啡機了。
你還需做几個漂亮的網頁，解釋一下怎么煮咖啡，然后再把它挂到<B> apache </B>服務器上.....
<P>
<HR>
<A HREF="Coffee-4.html"><IMG SRC="../img/next.gif" ALT="Next"></A>
<A HREF="Coffee-2.html"><IMG SRC="../img/prev.gif" ALT="Previous"></A>
<A HREF="Coffee.html#toc3"><IMG SRC="../img/toc.gif" ALT="Contents"></A>
<SCRIPT>EndPage();</SCRIPT>  </BODY>
</HTML>
