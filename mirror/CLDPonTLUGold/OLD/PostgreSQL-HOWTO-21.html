<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=big5">
 <META NAME="GENERATOR" CONTENT="ZH-SGML-Tools 1.0.9">
 <TITLE> Linux 的 Database-SQL-RDBMS HOWTO 文件 (PostgreSQL 物件關聯資料庫系統): PHP Hypertext PreProcessor—PostgreSQL 的伺服器端 html 嵌入命令稿語言</TITLE>
 <LINK HREF="PostgreSQL-HOWTO-22.html" REL=next>
 <LINK HREF="PostgreSQL-HOWTO-20.html" REL=previous>
 <LINK HREF="PostgreSQL-HOWTO.html#toc21" REL=contents>
<SCRIPT src="menu.js"> function BeginPage() {} function EndPage() {} </SCRIPT> </HEAD> <BODY bgcolor=#EEEEFF MARGINHEIGHT=0 MARGINWIDTH=0> <SCRIPT>BeginPage(0, 2, 5);</SCRIPT>
<A HREF="PostgreSQL-HOWTO-22.html"><IMG SRC="img/next.gif" ALT="Next"></A>
<A HREF="PostgreSQL-HOWTO-20.html"><IMG SRC="img/prev.gif" ALT="Previous"></A>
<A HREF="PostgreSQL-HOWTO.html#toc21"><IMG SRC="img/toc.gif" ALT="Contents"></A>
<HR>
<H2><A NAME="PHP"></A> <A NAME="s21">21. PHP Hypertext PreProcessor—PostgreSQL 的伺服器端 html 嵌入命令稿語言</A></H2>

<P>萬維網介面工具位於︰
<UL>
<LI> 
<A HREF="http://www.php.net">http://www.php.net</A></LI>
<LI> 
<A HREF="http://www.vex.net/php">http://www.vex.net/php</A></LI>
</UL>

PHP 也有一個名為 Zend 的編譯器，可大幅改善表現。首先你在開發、測試和除錯時使用 
PHP 命令稿語言。當準備好正式使用時使用 Zend 編譯器產生可迅速執行的執行檔。
<P>前身為 Professional Home Pages（PHP）而現在稱為 PHP Hypertext Pre-Processor
<UL>
<LI> 很多國定都有映射站台，名為 www.COUNTRYCODE.php.net</LI>
<LI> 
<A HREF="http://www.fe.de.php.net">http://www.fe.de.php.net</A></LI>
<LI> 
<A HREF="http://www.sk.php.net">http://www.sk.php.net</A></LI>
<LI> 
<A HREF="http://php.iquest.net/">http://php.iquest.net/</A></LI>
<LI> 問題可電郵到︰
<A HREF="mailto:rasmus@lerdorf.on.ca">rasmus@lerdorf.on.ca</A></LI>
</UL>

PHP 是一個伺服器端 html 嵌入命令稿語言。它讓你在你的 .HTML 
檔中加入簡單的命令稿，像 JavaScript 般。不過，和 JavaScript 不同，PHP 
獨立於瀏覽器。JavaScript 是一種客戶端的 html 嵌入命令稿語言，而 PHP 
是伺服器端語言。PHP 的概念和 Netscape 的 LiveWire Pro 
產品相似。如果你喜歡快速更新又包括源程式碼的自由軟件，你大概會喜歡 PHP 3。
<P>
<UL>
<LI> 支援 PostgreSQL 的程式碼由 Adam Sussman 寫成
<A HREF="mailto: asussman@vidya.com">asussman@vidya.com</A></LI>
</UL>
<P>
<H2><A NAME="ss21.1">21.1 主要特色</A>
</H2>

<P>
<UL>
<LI>標準的 CGI，FastCGI 和 Apache 模組支援—
作為一個標準的 CGI 程式，PHP 可在執行任何 Unix 互聯網伺服器的任何 Unix 
電腦上安裝。加上對新 FastCGI 標準的支援，PHP 可從中得到速度上的改善。作為一個 
Apache 模組， PHP 變成 CGI 程式外一個強勁及<B>快如閃電</B>的選擇。
</LI>
<LI> 存取記錄 (Access Logging)—
籍著 PHP 的存取紀錄功能，用者可自行維護命中數字 (hit counting) 
及作出紀錄。它完全不利用系統中央的紀錄檔，而且即時監察存取過程。Log Viewer 
Script 提供了個別用者擁有的頁面的存取摘要。此外，
本套件可被設定為在每頁產生一個顯示存取資料的註腳。本頁的結尾就有一個例子。
</LI>
<LI> 存取控制 (Access Control)—
一個以萬維網為基礎的內建設定畫面處理取控制設定。
用者可以為某人擁有的所有或個別網頁建立規則，限制誰人能及他能怎樣閱讀有關網頁。
根據用者的網域、瀏覽器、電郵地址甚至來源文件 (referring 
document)，網頁可以密碼保護、完全看不到、禁止紀錄 (logging disabled) 
和做其他事。
</LI>
<LI> PostgreSQL 支援—
Postgres 是一個先進的自由 RDBMS。利用 PHP，用者可直接在 .HTML 檔中嵌入 
PostgreSQL 的「SQL 查詢」。
</LI>
<LI> RFC-1867 檔案上傳支援—
檔案上傳是 Netscape 2.0 的新功能。它讓用者把檔案上傳到萬維網伺服器。
使得這事行可的原因，是實際的 Mime 解碼由 PHP 提供，它可提供額外的框架，
在收到上傳的檔案後做些有用的事。
</LI>
<LI> HTTP 為基礎的認證控制—
PHP 可用來在 Apache 萬維網伺服器中建立自定的以 HTTP 為基礎的認證機制。
</LI>
<LI> 變數、列陣、相聯列陣 (Associative Arrays)—
PHP 支援變數形態、列陣、甚至如 Perl 般的相聯列陣。它們可籍 GET 或 POST 
方法在網頁間傳遞。
</LI>
<LI> 條件式、While 迴圈—
PHP 支援一種類似 C 的全功能命令稿語言。你可使用 if/then/elseif/else/endif 
條件式、while 迴圈和 switch/case 敘述來指引你的 html 頁的顯示的邏輯流向。
</LI>
<LI> 延伸正規表達式—
正規表達式常被用於樣式匹配、樣式替換 (pattern substitutions) 
和一般的字串處理。PHP 支援所有常用的正規表達式運作。
</LI>
<LI> 原始 HTTP 標頭控制—
要進行高階網站設計，使網頁視情形傳送自定 HTTP 標頭的能力是必須的。
一個慣常用法是傳送一個 Location: URL 標頭來把客戶端傳送到其他 
URL。它也可用於關掉快取或處理網頁頁首上的“last update”標頭。
</LI>
<LI> 即時 GIF 圖像產生—
PHP 支援 Thomas Boutell 的 GD 圖像函式庫，使它可即時產生 GIF 圖像。
</LI>
<LI> ISP“安全模式”支援—
PHP 支援一個獨有的“安全模式”(Safe Mode)，使得在同一伺服器上有多個用戶使用 
PHP 命令稿也沒安全問題。
</LI>
<LI> 新版本的 PHP 加入了很多新功能，請參閱主網頁 
<A HREF="http://www.php.net">http://www.php.net</A>
</LI>
<LI> 它是自由的！
最後一個必要的特性。這套件是完全自由的。它以 GNU/GPL 
授權，讓你可為任何目的使用這軟件，包括商業用途。欲知詳情，請參看 GNU General 
Public License 文件。</LI>
</UL>
<H2><A NAME="ss21.2">21.2 PHP—簡史</A>
</H2>

<P>初出現時，PHP 是一個以 Perl 寫成小巧簡單的 cgi 包裝器 
(wrapper)。這套件最先名為 Personal Home Page Tools，後來變為 Personal Home 
Page Construction Kit。
<P>另有一工具是寫來簡化在網頁中嵌入 SQL 查詢的工作。它基本上是另一個 CGI 
包裝器，能分析 (parsed) SQL 查詢及簡化建立根據這些查詢的表格和列表的工作。
這工具名為 FI (Form Interpreter)。
<P>PHP/FI 2.0 版完全重寫這兩套件，將之合而為一。它進化至可把簡單電腦語言嵌入 
HTML 檔中。它籍著把所簡單的命令稿直接嵌入 HTML 檔中，消除大量小型 Perl cgi 
程式的需要。這樣會加快你的網頁，因為 fork 多次 Perl 的困擾已經消除。
它也簡化了管理大型網站的工作，因為你可把網頁的所有部分放在一個 html 
檔中。加上多種資料庫的支援，可使用資料庫的網頁的開發變得簡單。
很多人覺得嵌入查詢比分別建立 HTML 和 CGI 檔簡單得多。
<P>PHP/FI 已改名為 PHP。
<H2><A NAME="ss21.3">21.3 那麼，我能用 PHP 做什麼？</A>
</H2>

<P>如果你使用 PHP，你首先會注意到它在頁尾加上這網頁曾被瀏覽過多少次的資料
（如果你在在編譯時選取了 access logging）。這只是 PHP 所做的一小部分。
它的另一個重要角色是作為一個表格直譯 cgi 程式 (form interpreter 
cgi)，這也就是首名中 FI 的意思。例如，如果你在一個網頁中建立了一個表格，
你需要一個程式來處理表格上的資料。即使你只想把資料傳送到另一網頁，你也需要 
cgi 程式的幫助。PHP 使得取得和處理表格的資料極為容易。
<H2><A NAME="ss21.4">21.4 一個簡單的例子</A>
</H2>

<P>假設你有一張表格︰
<BLOCKQUOTE><CODE>
<PRE>
&lt;FORM ACTION="/cgi-bin/php.cgi/~userid/display.html" METHOD=POST>
&lt;INPUT TYPE="text" name="name">
&lt;INPUT TYPE="text" name="age">
&lt;INPUT TYPE="submit">
&lt;FORM>
</PRE>
</CODE></BLOCKQUOTE>

你的 display.html 便可包括類似的東西︰
<BLOCKQUOTE><CODE>
<PRE>
&lt; ?echo "Hi $ name, you are $ age years old!&lt;p>" &gt;
</PRE>
</CODE></BLOCKQUOTE>

就是這樣簡單！PHP 自動為每個表格輸入欄位產生一個變數。之後你便可在 ACTION URL 
檔中使用這些變數。
<P>在你找出如何使用變數之後的步驟就是在網頁中試用一些邏輯流程標籤。例如，
如果你想根據用者輸入顯示不同訊息，你可使用 if/else 邏輯。在上面的例子，
我們可改變 display.html，使得不同東西會根據用戶輸入顯示出來︰
<BLOCKQUOTE><CODE>
<PRE>
&lt;?
    if($age>50);
        echo "Hi $name, you are ancient!&lt;p>";
    elseif($age>30);
        echo "Hi $name, you are very old!&lt;p>";
    else;
        echo "Hi $name.";
    endif;
>
</PRE>
</CODE></BLOCKQUOTE>

PHP 提供一種非常強勁的命令稿語言，能做到的事比以上簡單的例子多很多。欲知詳情，
請參閱有關 PHP Script Language 的章節。
<P>你也可使用 PHP 來設定有什麼人能看到你的網頁。這可使用一個內建的設定畫面做到。
例如，籍著它你可指定只有某些網域的人可看到你的網頁，
或建立一些規則來用密碼保護某些網頁。欲知詳情，請參閱有關 Access Control 的章節。
<P>PHP 也有能力接收任何依照 RFC-1867 規定的瀏覽器上傳的檔案。
這特色使用者能上傳文字或二元檔。籍著 PHP 的存取控制和邏輯功能，
你可全面控制淮許誰上傳及上傳後做什麼。欲知詳情，請參閱有關 File Upload 的章節。
<P>PHP 支援 PostgreSQL 資料庫套件。它支援在 .HTML 檔中嵌入 SQL 查詢。
<P>PHP 也支援 mysql 資料庫套件。它支援在 .HTML 檔中嵌入 SQL 查詢。
<H2><A NAME="ss21.5">21.5 CGI 改向 (Redirection)</A>
</H2>

<P>
<H3>Apache 1.0.x 摘要</H3>

<P>使用 Apache 伺服器的 cgi 改向模組是執行 PHP 的一個好方法。
請注意你無須擔心改向模組，如果你使用 PHP 的 Apache 模組版本 (Apache module 
version)。有兩個這類改向模組。一個是 Dave Andersen 開發的︰
<UL>
<LI>       
<A HREF="mailto:angio@aros.net">angio@aros.net</A></LI>
</UL>

它可在以下地方找到
<UL>
<LI>     
<A HREF="ftp://ftp.aros.net/pub/util/apache/mod_cgi_redirect.c">ftp://ftp.aros.net/pub/util/apache/mod_cgi_redirect.c</A></LI>
</UL>

另一個已包括在 Apache 中，名為 mod_actions.c。這些模組極為相似，
只是在用法上有少許差別。兩個都測試過，能和 PHP 順利合作。
<P>查看 Apache 的文件關於如何加入一個模組。一般來說，你把模組名稱加到一個名為
Configuration 的檔案中。如果你使用 mod_actions 模組，你要加的一句是︰
<P>Module action_module mod_actions.o
<P>如果你使用 mod_cgi_redirect 模組，加上以下一句︰
<P>Module cgi_redirect_module mod_cgi_redirect.o
<P>重新編譯你的 httpd 及安裝它。要設定 cgi 改向你需要在你的 mime.types 
檔中建立新的 mime 類型，或在你的 srm.conf 檔中使用 AddType 指令來加上 mime 
類型。所加上的 mime 類型應類似︰
<BLOCKQUOTE><CODE>
<PRE>
     application/x-httpd-php phtml
</PRE>
</CODE></BLOCKQUOTE>

如果你使用 mod_actions.c 模組，你需在 srm.conf 檔中加上以下一行︰
<BLOCKQUOTE><CODE>
<PRE>
     Action application/x-httpd-php /cgi-bin/php.cgi
</PRE>
</CODE></BLOCKQUOTE>

如果你使用 mod_cgi_redirect.c 模組，你需在 srm.conf 檔中加上以下一行︰
<BLOCKQUOTE><CODE>
<PRE>
     CgiRedirect application/x-httpd-php /cgi-bin/php.cgi
</PRE>
</CODE></BLOCKQUOTE>

不要同時使用 mod_actions.c 和 mod_cgi_redirect.c。
<P>安裝及正確設定了這些 cgi 改向模組後，你只需把延伸檔名定為 .phtml，
便可以指定這檔案由 PHP 分析。此外，如果你在 srm.conf 檔的 DirectoryIndex 
設定行加上 index.phtml，最上層的網頁便會自動由 php 分析，如果你的 index 
檔名為 index.phtml。
<H3>Netscape HTTPD</H3>

<P>你可籍 Netscape Server CGI Redirection 
模組來指定自動把對某些延伸檔名的檔案的要求改向給 PHP。這模組可在 PHP 網頁的 
File Archieves 中找到。套件中的 README 明確地解釋了如何設定它來用於 PHP。
<H3>NCSA HTTPD</H3>

<P>目前，NCSA 並不支援模組，所以，要使用 cgi 改向的話，你要修改伺服器的原始碼。
一個對 NCSA 1.5 做這工作的嵌補在在 PHP 檔案存庫中找到。
<H2><A NAME="ss21.6">21.6 在指令行執行 PHP</A>
</H2>

<P>如果你建立了 CGI 版本的 PHP，你只需在指令行輸入 php.cgi filename，而filename 
是你想分析的檔案。你可建立獨立的 PHP 命令稿，只需把命令稿 (script) 
的第一行寫為類似︰
<BLOCKQUOTE><CODE>
<PRE>
    #!/usr/local/bin/php.cgi -q
</PRE>
</CODE></BLOCKQUOTE>

“-q”阻止印出 HTTP 標頭。喜歡的話，你可不用這選擇。
<H2><A NAME="ss21.7">21.7 PHPGem 套件</A>
</H2>

<P>PHPGem 是一個 PHP 命令稿，用以加速編寫使用表格的 PHP 命令稿。它可用於不同的 
SQL 伺服器，如 PostgreSQL、MySQL、mSQL、ODBC 和 Adabas。
你輸入表格欄位的描述和參數（欄位名稱、欄位的 on/off searching (?) 等等），
PHPGem 輸出另一個使用那些表格的 PHP 命令稿（檢視/加/修改/刪除/重覆內容和搜索）。
PHPGem 可使用多層巢狀表格 (multi-level nested tables, ??)。PHPGem 
容許你指定每個表格每個欄位每人旳存取控制。PHPGem 也支援影像。
<P>PHPGem 在 
<A HREF="http://sptl.org/phpgem">http://sptl.org/phpgem</A> 找到。
<HR>
<A HREF="PostgreSQL-HOWTO-22.html"><IMG SRC="img/next.gif" ALT="Next"></A>
<A HREF="PostgreSQL-HOWTO-20.html"><IMG SRC="img/prev.gif" ALT="Previous"></A>
<A HREF="PostgreSQL-HOWTO.html#toc21"><IMG SRC="img/toc.gif" ALT="Contents"></A>
<SCRIPT>EndPage();</SCRIPT>  </BODY>
</HTML>
