<HTML
><HEAD
><TITLE
>Shell腳本語言（sh及csh的變種）</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.54"><LINK
REL="HOME"
TITLE="Linux和Unix安全編程HOWTO"
HREF="book1.html"><LINK
REL="UP"
TITLE="特定語言的問題"
HREF="c760.html"><LINK
REL="PREVIOUS"
TITLE="Python"
HREF="x801.html"><LINK
REL="NEXT"
TITLE="Ada"
HREF="x811.html"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Linux和Unix安全編程HOWTO</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x801.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 9. 特定語言的問題</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x811.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AEN806"
>Shell腳本語言（sh及csh的變種）</A
></H1
><P
>我強烈反對在setuid/setgid安全代碼中使用標准命令shell的腳本語言（如csh、sh和bash）。有些系統（如Linux）完全禁用它們，所以會制造不必要的移植性問題。在某些老的系統上，由于競爭狀態（像在進程一節討論的那樣）它們基本上是不安全的。即使對于其它系統，它們也確實不是個好想法。標准命令shell由于會受到不明顯輸入的影響而依舊聲名狼籍 -- 通常是由于它們在設計時是為了某個交互式用戶“自動”地完成工作，而不是防范某個堅定的攻擊者。例如，“隱藏的”環境變量甚至在腳本執行前就可以影響它們如何操作。即使是可執行文件的文件名或目錄下的內容都會產生影響。例如，在許多Bourne shell的實現上，如下操作會獲得root權限（感謝NCSA描述了這種利用）：
<TABLE
BORDER="0"
BGCOLOR="#E0E0E0"
WIDTH="100%"
><TR
><TD
><PRE
CLASS="PROGRAMLISTING"
> % ln -s /usr/bin/setuid-shell /tmp/-x
 % cd /tmp
 % -x</PRE
></TD
></TR
></TABLE
>
有些系統可能已經填補了這一漏洞，但問題依然存在：大多數命令shell不是用來編寫安全程序的。出于編程目的，應該即使在許可的系統上也避免創建setuid的shell腳本。作為替代，用其它語言編寫一個小程序來清除環境，然后調用其它可執行程序（有些可能是shell腳本）。</P
><P
>如果一定要使用shell腳本語言，至少應該把腳本放在一個不可被移動或改變的目錄下，而且在腳本中非常明確地把PATH和IFS設為已知值。</P
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x801.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x811.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Python</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c760.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Ada</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>