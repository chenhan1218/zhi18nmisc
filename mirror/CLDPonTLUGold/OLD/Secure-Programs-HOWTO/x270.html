<HTML
><HEAD
><TITLE
>文件</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.54"><LINK
REL="HOME"
TITLE="Linux和Unix安全編程HOWTO"
HREF="book1.html"><LINK
REL="UP"
TITLE="Linux和Unix安全特性概要"
HREF="c211.html"><LINK
REL="PREVIOUS"
TITLE="Linux和Unix安全特性概要"
HREF="c211.html"><LINK
REL="NEXT"
TITLE="System V的IPC"
HREF="x316.html"></HEAD
><BODY
CLASS="SECT1"
><DIV
CLASS="NAVHEADER"
><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
>Linux和Unix安全編程HOWTO</TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="c211.html"
>Prev</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
>Chapter 3. Linux和Unix安全特性概要</TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="x316.html"
>Next</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="SECT1"
><H1
CLASS="SECT1"
><A
NAME="AEN270"
>文件</A
></H1
><P
>對于所有類Unix系統，最主要的信息存放地點是根為“/”的文件樹。文件樹是一個目錄的分級結構，每個目錄都可以保護文件系統對象（FSO）。</P
><P
>在Linux中，文件系統對象（FSO）可以是普通文件、目錄、符號連接、命名管道（FIFO）、套接字（參見下文說明）、特殊字符（設備）文件或特殊塊（設備）文件（在Linux下可以用find(1)命令顯示其列表）。其它類Unix系統有同樣或相似的一組FSO類型。</P
><P
>文件系統對象由文件系統收集，可以在文件樹的目錄下安裝和卸載。文件系統的類型（如ext2和FAT）是一組管理磁盤上數據以優化速度、可靠性等等的特殊規范集﹔很多人用“文件系統”作為文件系統類型的同義詞。</P
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN275"
>文件系統對象的屬性</A
></H2
><P
>不同的類Unix系統支持不同的文件系統類型。文件系統的訪問控制屬性可以稍有區別，在安裝時選擇的選項也會影響訪問控制。在Linux下，ext2文件系統是目前最常用的文件系統，但Linux還支持大量的文件系統。絕大多數類Unix系統也都支持多個文件系統。</P
><P
>類Unix系統上的絕大多數文件系統至少都包含以下內容：

<P
></P
><UL
><LI
><P
>擁有UID和GID -- 標識文件系統對象的“所有者”。除非另加說明，只有所有者或root可以改變存取控制屬性。</P
></LI
><LI
><P
>許可比特位 -- 每個用戶（所有者）、群組及其他人的讀、寫和執行比特位。對于一般文件，讀、寫和執行就是相應的典型意義。對于目錄，顯示目錄下內容需要“讀”許可，而在實際進入目錄以使用其內容時需要的“執行”許可有時被稱為“查找”許可。一個目錄的“寫”許可是允許在目錄內對文件進行增加、移動和改名操作﹔如果只想允許增加文件，設置下面說明的“sticky”比特位。注意，符號連接的許可值沒有用﹔其對應的目錄和連接文件的許可值才是真正有效的。</P
></LI
><LI
><P
>“sticky”比特位 -- 在目錄被設置之后，只有root、文件所有者或目錄所有者才能在該目錄下解除連接（刪除）和改變文件名。這是一個很常用的Unix擴展，在Open Group的單一Unix規格版本2中有其定義。
老版本的Unix把它叫做“保存程序正文”比特位，并用它來標明需要保留在內存的可執行文件。系統這樣做確保了只有root可以設置此比特位。（否則用戶可以強制“所有內容”都保存在內存中來使系統崩潰）。在Linux下該比特位對普通文件沒有影響，而且普通用戶可以修改所擁有文件的該比特位﹔Linux的虛擬內存管理使這種老用途不再重要。</P
></LI
><LI
><P
>setuid, setgid -- 在對可執行文件設置后，執行該文件會（相應地）把進程的有效UID或有效GID設為文件擁有UID或GID。所有的類Unix系統都支持這一點。在Linux和System V系統中，在對沒有執行權限的文件設置了setgid時，該文件在存取時將被強制鎖定（如果安裝的文件系統支持強制鎖定的話）﹔這種意義重載使很多人詫異，而且在類Unix系統中并不常見。事實上，如果這樣的設置沒有意義，在Open Group的單一Unix規格版本2中chmod(3)將允許系統忽略打開不可執行文件setgid的請求。在Linux和Solaris中，對目錄設置setgid時，該目錄下創建的文件會自動把自己的GID設置為目錄的GID。這樣做的目的是支持“工程目錄”：用戶可以把文件保存在如此特別設定的目錄下，文件的群組所有者就自動改變。但是，對目錄設置setgid比特位沒有被單一Unix規格[Open Group 1997]之類的標准所定義。</P
></LI
><LI
><P
>時間戳 -- 保存每個文件系統對象存取和修改的時間。盡管如此，文件系統對象的所有者可以任意設置這些值（參見touch(1)），所以在信任該信息時要小心。所有的類Unix系統都支持這一點。</P
></LI
></UL
>&#13;</P
><P
>下面是對ext2文件系統inux獨有的屬性，雖然很多其它文件系統也有類似的功能：

<P
></P
><UL
><LI
><P
>不可改變的比特位 -- 不允許改變文件系統對象﹔只有root可以設置或清除該比特位。只有ext2支持它，不能在所有Unix系統中移植（甚至不能在所有Linux文件系統中移植）。</P
></LI
><LI
><P
>只附加比特位 -- 只允許對文件系統對象進行附加操作﹔只有root可以設置或清除該比特位。只有ext2支持它，不能在所有Unix系統中移植（甚至不能在所有Linux文件系統中移植）。</P
></LI
></UL
>&#13;</P
><P
>其它的常見擴展包括表明“不可刪除此文件”的某種比特位。</P
><P
>很多這樣的值在安裝時會受影響，所以，諸如特定的比特位可以被當做具有某個特定值（無論在媒介上它們的值如何）來處理。參見mount(1)以了解更多的有關信息。有些文件系統不支持其中的某些存取控制值﹔也可參見mount(1)以了解這些文件系統是如何進行處理的。比較特別的是，很多類Unix系統支持MS-DOS磁盤，其缺省狀態只支持其中的很少屬性（而且沒有標准方法來定義這些屬性）。在這種情況下，類Unix系統仿效標准屬性（可能通過特殊的磁盤文件來實現），而且這些屬性一般會受mount(1)命令影響。</P
><P
>需要特別注意，除非類Unix系統支持更為復雜的規范（如POSIX的ACL），對于增加和移動文件，只有許可比特位和文件所在<I
CLASS="EMPHASIS"
>目錄</I
>的擁有者確實有意義。除非系統有其它的擴展，而標准Linux 2.2沒有擴展，如果所在目錄允許，沒有被許可比特位授予許可的文件還是可以被移開的。同樣，如果上級目錄允許其子目錄被某些用戶或群組改變，那么該目錄的下級目錄就可以被那些用戶或群組更換。</P
><P
>IEEE有關安全的POSIX標准草案為支持用戶和群組許可列表的真實ACL定義了一項技朮。不幸的是這并未得到類Unix系統的廣泛支持，而且類Unix系統支持的方式也不完全一樣。例如，標准的Linux 2.2在文件系統中既沒有ACL，也沒有POSIX能力值。</P
><P
>Linux中的ext2文件系統缺省為root用戶保留少量空間，這在Linux下算不了什么。這可以部分抵御拒絕服務攻擊﹔即使某個用戶占完了與root用戶共享的磁盤，root用戶還剩下少量空間（如用于關鍵函數）。該缺省值為文件系統空間的5%﹔參見mke2fs(8)，特別是其中的“-m”選項。</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN302"
>創建時的初始值</A
></H2
><P
>在創建時，應用以下規則。在絕大多數Unix系統中，通過creat(2)或open(2)來創建一個新的文件系統對象（FSO）時，FSO的UID被設為進程的EUID，而FSO的GID被設為進程的EGID。Linux由于存在FSUID和setgid目錄擴展，與此稍有區別﹔FSO的UID被設為進程的FSUID，而FSO的GID被設為進程的FSGID﹔如果所在目錄的setgid比特位被設置，或者文件系統的“GRPID”標志被設置，FSO的GID實際上被設為所在目錄的GID。這一特性支持“工程”目錄：生成一個“工程”目錄，為該工程創建一個特殊的群組，為該群組所擁有的工程創建一個目錄，然后使該目錄成為setgid：放入該目錄下的文件自動被該工程所擁有。類似的，如果一個新的子目錄創建在設置了setgid比特位（而文件系統的GRPID沒有設置）的目錄下，新的子目錄的setgid比特位也被設置（這樣工程的子目錄也“工作正常”）﹔在其它情況下，新文件的setgid被清除。FSO的基本存取控制值（讀、寫、執行）是計算得來的（請求值&#38; ~進程的umask）。新文件開始總是具有一個清除了的sticky比特位和一個清除了的setuid比特位。</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN305"
>改變存取控制屬性</A
></H2
><P
>可以用chmod(2)、fchmod(2)或chmod(1)來設置大多數這樣的值，但請參考chown(1)和chgrp(1)。在Linux下，有些Linux獨有的屬性用chattr(1)來操作。</P
><P
>注意，在Linux下只有root可以改變一個給定文件的所有者。某些類Unix系統允許普通用戶把自己文件的所有關系傳遞給其他人，但這使情況復雜化，在Linux中是禁止的。例如，如果要限制磁盤的使用，允許這樣的操作就允許用戶宣稱大文件實際上屬于某些其他的“受害者”。</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN309"
>使用存取控制屬性</A
></H2
><P
>在Linux和大多數類Unix系統下，只有在打開文件時檢查讀和寫屬性的值﹔在每次讀或寫操作時不再檢查這些值。因為文件系統是類Unix系統的中心，還有很多調用會檢查這些屬性。檢查這些屬性的調用包括open(2)、creat(2)、link(2)、unlink(2)、rename(2)、mknod(2)、symlink(2)和socket(2)。</P
></DIV
><DIV
CLASS="SECT2"
><H2
CLASS="SECT2"
><A
NAME="AEN312"
>文件系統分級結構</A
></H2
><P
>這些年來一直是在“什么文件放在哪里”的基礎之上建立規則的。如果可能，請依照這些規則把信息放進分級結構里。例如，把全局配置信息放入/etc。文件系統分級結構標准（FHS）試圖以一種合乎邏輯的方式定義這些規則，而且在Linux上得到了廣泛應用。FHS是以前Linux的文件系統結構標准（FSSTND）的更新版本，包含了從Linux、BSD和System V等系統上得到的教訓與實踐。參見
<A
HREF="http://www.pathname.com/fhs"
TARGET="_top"
>http://www.pathname.com/fhs</A
>
以了解有關FHS的更多信息。有關這些規則的概要在Linux的hier(5)和Solaris的hier(7)中。有時，不同的規則相互沖突﹔如果可能，使這些情況在編譯或安裝時可以配置。</P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="c211.html"
>Prev</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="book1.html"
>Home</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="x316.html"
>Next</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Linux和Unix安全特性概要</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="c211.html"
>Up</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>System V的IPC</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>