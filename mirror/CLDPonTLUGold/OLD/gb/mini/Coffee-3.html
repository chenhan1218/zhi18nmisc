<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD><META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=gb2312">
 <META NAME="GENERATOR" CONTENT="ZH-SGML-Tools 1.0.9">
 <TITLE>COFFEE-HOWTO --如何用 Linux 来煮咖啡: 软件</TITLE>
 <LINK HREF="Coffee-4.html" REL=next>
 <LINK HREF="Coffee-2.html" REL=previous>
 <LINK HREF="Coffee.html#toc3" REL=contents>
<SCRIPT src="../menu.js"> function BeginPage() {} function EndPage() {} </SCRIPT> </HEAD> <BODY bgcolor=#EEEEFF MARGINHEIGHT=0 MARGINWIDTH=0> <SCRIPT>BeginPage(1, 2, 6);</SCRIPT>
<A HREF="Coffee-4.html"><IMG SRC="../img/next.gif" ALT="Next"></A>
<A HREF="Coffee-2.html"><IMG SRC="../img/prev.gif" ALT="Previous"></A>
<A HREF="Coffee.html#toc3"><IMG SRC="../img/toc.gif" ALT="Contents"></A>
<HR>
<H2><A NAME="s3">3. 软件</A></H2>

<P>
<P>
<H2><A NAME="ss3.1">3.1 软件</A>
</H2>

<P>你必须得到一个有以下功能的可执行程序：
<UL>
<LI>通过<B> ioperm </B>命令，例如，<EM>ioperm ( BASE, range , 1)，</EM>调用内核，得到 I/O 地址空间的使用权;</LI>
<LI>通过一个发送请求指令，例如，<EM> outb(1, BASE ) </EM>，设定并口电压为 0-5V；</LI>
<LI>等待足够的时间让咖啡煮好，让时间参数在命令行中被读取是一件很好的事情；</LI>
<LI>然后发送 out(0, BASE) 指令关掉咖啡机；</LI>
<LI>在结束之前还应归还并口 I/O 地址的使用权，<EM> ioperm(BASE,range,0)；</EM></LI>
</UL>

改变 /dev/lp0 的基地址为 0x3bc ，/dev/lp1 为 0x378 ，/dev/lp2 为 0x278，范围( range ) 为 8 。
<P>
<P>如果在这个程序中再使用 setuid 会更好，因为每个用户都可以用 Linux 煮咖啡了！
<P>
<H2><A NAME="ss3.2">3.2 设备驱动程序</A>
</H2>

<P>
<P>参考 
<A HREF="http://www.redhat.com:8080/HyperNews/get/khg.html">kernel hacker's guide</A>, 
安装一个设备驱动程序 (it could even be user space i think). 
请以模块(module)方式编译，这样以后每次更新的时候也用不著重新编译内核了。
然后打入:
<P>
<PRE>
echo cappuccino >/dev/coffee
</PRE>
<P>1 分钟后你就会有一杯热咖啡，注意 /dev/coffee 要设置合适的权限，具体看你是否只想让超级用户煮咖啡了。
<P>
<P>这种方法有个优点就是它能用并口的 ACK 针脚来实现从咖啡机的反馈支持。所以一个智能的咖啡机有时还会中断一下。
<P>
<P>把它当作课外作业
<P>
<H2><A NAME="ss3.3">3.3 通过 Internet 连接</A>
</H2>

<P>如果你已经有了这个 C 程序（如上），你只需写一个 CGI 脚本就可以开关咖啡机了。
你还需做几个漂亮的网页，解释一下怎么煮咖啡，然后再把它挂到<B> apache </B>服务器上.....
<P>
<HR>
<A HREF="Coffee-4.html"><IMG SRC="../img/next.gif" ALT="Next"></A>
<A HREF="Coffee-2.html"><IMG SRC="../img/prev.gif" ALT="Previous"></A>
<A HREF="Coffee.html#toc3"><IMG SRC="../img/toc.gif" ALT="Contents"></A>
<SCRIPT>EndPage();</SCRIPT>  </BODY>
</HTML>
